<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="17年开发过程中遇到的一些小问题的解决">
<meta property="og:type" content="article">
<meta property="og:title" content="开发Fix集锦">
<meta property="og:url" content="http://bxh7425014.github.io/blog/2017/10/02/2017/2017-开发Fix集锦/index.html">
<meta property="og:site_name" content="一一小知">
<meta property="og:description" content="17年开发过程中遇到的一些小问题的解决">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-20d11f2209fa18d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-4b6c222a8a58b9b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-baba10b162ba7a8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-dc662ca6e44a805f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-65f932dda6a3a563.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-6f7b3a17448680ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-44a216ef633567ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-0acdf02e655a6b21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-cafa812c337b9dda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-354645d04b4f8dea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-800011f6576c5459.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-71fc1135d5c7fd27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-83d673bac43cee6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-8cd2d1ba3f10662f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-03c9e1c9357fca5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-7fd98d52457fcce1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-90098979794f271c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-c558efa9d3b64800.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-2dc1c92a826514f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-d87b1cb465fc58d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-70c2b4a3ae92c5ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-40b69d61d2279d1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-a957438d8596d89d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-ba9b3c9f90d01719.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-576681a37d2b6164.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-830ed6a10c3d4ce8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-3100b4c6495bda24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-72431949b4dbea59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-3074d60d642036a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-fb5a6365be6afce0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-8bebde5b06e8b7c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-8e6e0392561d5230.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-43b9d20268c97ccf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-d511854807bc664b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-46b93e3b9649a774.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-5ac4c0e08aecf19c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-7da5a6a072f86c27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1124873-4cadb4a3589fbd93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2019-01-29T10:45:22.859Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发Fix集锦">
<meta name="twitter:description" content="17年开发过程中遇到的一些小问题的解决">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1124873-20d11f2209fa18d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://bxh7425014.github.io/blog/2017/10/02/2017/2017-开发Fix集锦/">





  <title>开发Fix集锦 | 一一小知</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">一一小知</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">小知Blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bxh7425014.github.io/blog/2017/10/02/2017/2017-开发Fix集锦/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="无">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一一小知">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">开发Fix集锦</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-02T23:28:11+08:00">
                2017-10-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/开发/" itemprop="url" rel="index">
                    <span itemprop="name">开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
              <div class="post-description">
                  17年开发过程中遇到的一些小问题的解决
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="2017-4-9-ubuntu服务器环境搭建"><a href="#2017-4-9-ubuntu服务器环境搭建" class="headerlink" title="2017-4-9 ubuntu服务器环境搭建"></a>2017-4-9 ubuntu服务器环境搭建</h1><blockquote>
<p>配置ssh链接，jdk，hadoop，Samba</p>
</blockquote>
<h2 id="配置Linux环境属性"><a href="#配置Linux环境属性" class="headerlink" title="配置Linux环境属性"></a>配置Linux环境属性</h2><ul>
<li><p>修改终端字体大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpky-reconfigure console-setup</span><br></pre></td></tr></table></figure>
</li>
<li><p>第一次root用户解锁操作</p>
<ul>
<li><p>修改root密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure>
</li>
<li><p>用户注销</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">logout</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ubuntu16.04切换到root用户登录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure>
</li>
<li><p>以root用户进行登录</p>
</li>
<li>who命令来查看是谁登录。</li>
</ul>
</li>
<li><p>关闭Linux防火墙</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>卸载iptables组件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get remove iptables</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装vim</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install vim</span><br></pre></td></tr></table></figure>
</li>
<li><p>Hostname主机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="ssh连接配置"><a href="#ssh连接配置" class="headerlink" title="ssh连接配置"></a>ssh连接配置</h2><ul>
<li><p>ssh工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install openssh-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动ssh服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/ssh start</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看是否服务已经启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -e | grep sshd</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决默认不能root用户登录使用ssh的问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>随后修改PermitRootLogin，将内容设置为yes</p>
<h2 id="ftp服务"><a href="#ftp服务" class="headerlink" title="ftp服务"></a>ftp服务</h2><ul>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install vsftpd</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改默认ftp用户的密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd ftp</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ftp完成后，会自动创建目录 /srv/ftp，修改权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /srv/ftp</span><br></pre></td></tr></table></figure></p>
<p>如果要ftp正常工作，修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd.conf</span><br></pre></td></tr></table></figure></p>
<p>修改如下参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">anonymous_enable NO //不允许匿名登录</span><br><span class="line">...</span><br><span class="line">local_enable YES //允许本地用户登录</span><br><span class="line">...</span><br><span class="line">write_enable=YES //用户具有写权限</span><br><span class="line">...</span><br><span class="line">chroot_local_user=YES //是否将所有用户限制在主目录</span><br><span class="line">...</span><br><span class="line">chroot_list_enable=YES //是否启动限制用户的名单</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>定义名单设置的目录（名单中可以设置多个账号）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chroot_list_file=/etc/vsftpd.chroot_list</span><br></pre></td></tr></table></figure>
</li>
<li><p>增加一个服务配置 pam-service_name=vsftpd ，注意文件中不能存在此条信息的重复数据（我新增了一条，踩了个坑）。</p>
</li>
<li><p>增加一个新的文件，写上一个用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd.chroot_list</span><br></pre></td></tr></table></figure>
</li>
<li><p>在第一行写上ftp，表示新增一个用户</p>
</li>
<li><p>修改 vim /etc/pam.d/vsftpd,注释掉以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># auth required pam_shells.so</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service vsftpd start</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="JDK的安装与配置"><a href="#JDK的安装与配置" class="headerlink" title="JDK的安装与配置"></a>JDK的安装与配置</h2><ul>
<li>下载Linux版本jdk.</li>
<li>XShell使用rz命令传到服务器</li>
<li><p>解压</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/home/bianxh/Downloads# tar xzvf jdk-8u111-linux-x64.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开环境文件进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_111</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:</span><br><span class="line">export CLASS_PATH=$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure>
<ul>
<li><p>让配置立刻生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试下是否生效成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/usr/local/jdk1.8.0_111# java -version</span><br><span class="line">java version &quot;1.8.0_111&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_111-b14)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.111-b14, mixed mode)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="在Linux中安装Hadoop"><a href="#在Linux中安装Hadoop" class="headerlink" title="在Linux中安装Hadoop"></a>在Linux中安装Hadoop</h2><ul>
<li><p>上传Hadoop文件并解压缩</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/home/bianxh/Downloads# tar xzvf hadoop-2.6.0.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置环境变量，修改/etc/profile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_HOME=/usr/local/hadoop-2.6.0</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:</span><br></pre></td></tr></table></figure>
</li>
<li><p>让配置立刻生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>hadoop依赖jdk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/usr/local/hadoop-2.6.0/etc/hadoop# vim hadoop-env.sh</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#export JAVA_HOME=$&#123;JAVA_HOME&#125;</span><br><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_111</span><br></pre></td></tr></table></figure>
<p>Linux常用命令</p>
<ul>
<li><p>设置当前系统时间命令示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ date –set “10/15/2009 20:18”</span><br></pre></td></tr></table></figure>
</li>
<li><p>递归解压bz2g格式压缩包示例：</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -jxvf cygwin.tar.bz2 -C 指定目录</span><br></pre></td></tr></table></figure>
<ul>
<li>Samba服务器文件夹权限分配实例（修改/etc/samba/smb.conf）：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[bianxh]</span><br><span class="line">  comment = File Share of bianxh</span><br><span class="line">  browseable = yes</span><br><span class="line">  path = /home/bianxh/</span><br><span class="line">  writable = yes</span><br><span class="line">  create mask = 777</span><br><span class="line">  valid users = public bianxh</span><br><span class="line">  directory mask = 777</span><br><span class="line">  available = yes</span><br></pre></td></tr></table></figure>
<h1 id="2017-04-28-Mac开发环境搭建"><a href="#2017-04-28-Mac开发环境搭建" class="headerlink" title="2017-04-28 Mac开发环境搭建"></a>2017-04-28 Mac开发环境搭建</h1><blockquote>
<p>Mac下安装brew、Redis、zookeeper过程中踩过的坑。</p>
</blockquote>
<p>Mac serria偏好设置找到“打开任意来源”命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo spctl --master-disable</span><br></pre></td></tr></table></figure>
<p>重建MAC的右键打开方式列表<br>Mac上选中一个文件点击右键会有一个“Open With”菜单，如果你装过多个虚拟机等，这个菜单会出现很多windows系统的程序，从而使这个菜单十分混乱，可以使用以下命令行来清除所有的重复项。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -kill -r -domain local -domain user;killall Finder;echo “Open With has been rebuilt, Finder will relaunch“</span><br></pre></td></tr></table></figure></p>
<h1 id="Mac-Web开发环境配置"><a href="#Mac-Web开发环境配置" class="headerlink" title="Mac Web开发环境配置"></a>Mac Web开发环境配置</h1><h2 id="安装brew"><a href="#安装brew" class="headerlink" title="安装brew"></a>安装brew</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install\&quot;</span><br></pre></td></tr></table></figure>
<p>安装下载工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install wget</span><br></pre></td></tr></table></figure>
<h2 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://download.redis.io/releases/redis-3.0.7.tar.gz</span><br><span class="line">$ tar xzf redis-3.0.7.tar.gz</span><br><span class="line">$ cd redis-3.0.7</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure>
<p>启动redis</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ src/redis-server redis.conf</span><br></pre></td></tr></table></figure>
<p>连接上以后，关闭redis</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ src/redis-cli</span><br><span class="line">$ 127.0.0.1:6379&gt; SHUTDOWN</span><br></pre></td></tr></table></figure>
<p>测试redis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ src/redis-cli</span><br><span class="line">redis&gt; <span class="built_in">set</span> foo bar</span><br><span class="line">OK</span><br><span class="line">redis&gt; get foo</span><br><span class="line"><span class="string">"bar"</span></span><br></pre></td></tr></table></figure>
<p># Mac OS命令行下使用SublimeText打开文本文件</p>
<p>打开用户配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>添加如下alias</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias subl=&quot;&apos;/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl&apos;&quot;</span><br><span class="line">alias ll=&apos;ls -al&apos;</span><br></pre></td></tr></table></figure>
<p>如果不添加别名，也可以选择将路径添加到环境变量下。这里的路径根据实际情况可能会有所不同。</p>
<p>wq保存后回到命令行执行以下命令使其生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>命令行使用，这里我们假设在命令行用SublimeText打开.bash_profile，则执行如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subl ~/.bash_profile</span><br></pre></td></tr></table></figure>
<h2 id="安装zookeeper"><a href="#安装zookeeper" class="headerlink" title="安装zookeeper"></a>安装zookeeper</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$brew install zookeeper</span><br></pre></td></tr></table></figure>
<p>启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo zkServer start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/etc/zookeeper/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在MAC下需要用sudo命令来启动此服务，否则会失败。</p>
</blockquote>
<p>查看zookeeper运行及状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ zkServer status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/etc/zookeeper/zoo.cfg</span><br><span class="line">Mode: standalone</span><br><span class="line">$zkCli</span><br><span class="line">Connecting to localhost:2181</span><br></pre></td></tr></table></figure>
<p>停止服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ zkServer stop</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/etc/zookeeper/zoo.cfg</span><br><span class="line">Stopping zookeeper ... STOPPED</span><br></pre></td></tr></table></figure>
<h2 id="安装邮件服务-James-server"><a href="#安装邮件服务-James-server" class="headerlink" title="安装邮件服务 James server"></a>安装邮件服务 James server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ subl ~/.bash_profile</span><br><span class="line">export JAMES_SRC_HOME=/usr/local/james-project/james-project</span><br></pre></td></tr></table></figure>
<p>安装maven，<a href="https://james.apache.org/server/3/dev-build.html" target="_blank" rel="noopener">参考教程</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install maven</span><br></pre></td></tr></table></figure>
<p>默认安装位置是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/local/Cellar/maven/3.3.9</span><br></pre></td></tr></table></figure>
<h2 id="Fix-problems"><a href="#Fix-problems" class="headerlink" title="Fix problems"></a>Fix problems</h2><h3 id="maven报错："><a href="#maven报错：" class="headerlink" title="maven报错："></a>maven报错：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not calculate build plan: Plugin org.apache.maven.plugins:maven-resources-plugin:2.6 or one of its dependencies could not be resolved: Failed to read artifact descriptor for org.apache.maven.plugins:maven-resources-plugin:jar:2.6</span><br></pre></td></tr></table></figure>
<p>解决方法：</p>
<p>1、查看windows -&gt; Preferences -&gt; maven 的settings.xml文件中.m2的位置</p>
<p>2、然后将.m2/repository/org/apache/maven/plugins目录下的文件夹全部删除</p>
<p>3、选中maven项目，右键 –&gt; maven –&gt; update，让maven重新下载依赖包</p>
<blockquote>
<p>注：此IDE自带maven插件，不需要再自己下载安装maven插件</p>
</blockquote>
<h3 id="mac下，dubbo注册zookeeper，ip地址是一个虚拟的地址，并不是局域网的本机ip"><a href="#mac下，dubbo注册zookeeper，ip地址是一个虚拟的地址，并不是局域网的本机ip" class="headerlink" title="mac下，dubbo注册zookeeper，ip地址是一个虚拟的地址，并不是局域网的本机ip"></a>mac下，dubbo注册zookeeper，ip地址是一个虚拟的地址，并不是局域网的本机ip</h3><p>在搭建zookeeper的过程中，使用dubbo获取的地址总是220.250.64.26，通过jdk代码调用来看，确实是这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">InetAddress ia=<span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">ia=ia.getLocalHost();</span><br><span class="line"></span><br><span class="line">String localname=ia.getHostName();</span><br><span class="line">String localip=ia.getHostAddress();</span><br><span class="line">System.out.println(<span class="string">"本机名称是："</span>+ localname);</span><br><span class="line">System.out.println(<span class="string">"本机的ip是 ："</span>+localip);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>cosole输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本机名称是：bogon</span><br><span class="line">本机的ip是 ：220.250.64.26</span><br></pre></td></tr></table></figure></p>
<p>220.250.64.26是虚拟的地址，导致项目在tomcat下无法正常运行。<br>在mac终端可以看到，本机hostname是bogon，于是我们重设hostname，命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo scutil --set HostName bianxh</span><br><span class="line">$ sudo scutil --set LocalHostName bianxh</span><br></pre></td></tr></table></figure></p>
<p>然后修改hosts文件，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bogon:redis-3.0.7 bianxh$ subl /etc/hosts</span><br></pre></td></tr></table></figure></p>
<p>在末位新增两行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 bianxh</span><br><span class="line">::1 bianxh</span><br></pre></td></tr></table></figure></p>
<p>重新运行上面的java代码，可以看到ip地址正常了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本机名称是：bianxh</span><br><span class="line">本机的ip是 ：127.0.0.1</span><br></pre></td></tr></table></figure>
<p>接下来，通过dubbo注册zookeeper，可以看到console输出的注册地址就正常了，变为局域网内的本机地址。</p>
<h1 id="2017-09-16-微信开发：scope参数错误或没有scope权限解决方法"><a href="#2017-09-16-微信开发：scope参数错误或没有scope权限解决方法" class="headerlink" title="2017-09-16-微信开发：scope参数错误或没有scope权限解决方法"></a>2017-09-16-微信开发：scope参数错误或没有scope权限解决方法</h1><p>1、确保请求参数的顺序（注意response_type和scope前后顺序）：</p>
<p>scope为snsapi_base<br><a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx520c15f417810387&amp;redirect_uri=https%3A%2F%2Fchong.qq.com%2Fphp%2Findex.php%3Fd%3D%26c%3DwxAdapter%26m%3DmobileDeal%26showwxpaytitle%3D1%26vb2ctag%3D4_2030_5_1194_60&amp;response_type=code&amp;scope=snsapi_base&amp;state=123#wechat_redirect" target="_blank" rel="noopener">https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx520c15f417810387&amp;redirect_uri=https%3A%2F%2Fchong.qq.com%2Fphp%2Findex.php%3Fd%3D%26c%3DwxAdapter%26m%3DmobileDeal%26showwxpaytitle%3D1%26vb2ctag%3D4_2030_5_1194_60&amp;response_type=code&amp;scope=snsapi_base&amp;state=123#wechat_redirect</a> </p>
<p>scope为snsapi_userinfo<br><a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxf0e81c3bee622d60&amp;redirect_uri=http%3A%2F%2Fnba.bluewebgame.com%2Foauth_response.php&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect" target="_blank" rel="noopener">https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxf0e81c3bee622d60&amp;redirect_uri=http%3A%2F%2Fnba.bluewebgame.com%2Foauth_response.php&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect</a> </p>
<p>2、确保在合适的公众号上操作，比如我在正式公众服务号上进入一个需要经过OAuth的链接，却在代码中走的测试号的appid，那也会提示这个错误。</p>
<p>3、如果还是不行，那再到微信管理后台确认下，修改“网页帐号–&gt;网页授权获取用户基本信息”，使其生效，如图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-20d11f2209fa18d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-4b6c222a8a58b9b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>参考文档：</p>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842" target="_blank" rel="noopener">微信公众平台</a></p>
<p><a href="https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index" target="_blank" rel="noopener">微信公众平台</a>测试号管理配置页面。</p>
<h1 id="2017-09-16-微信服务号绑定踩过的坑"><a href="#2017-09-16-微信服务号绑定踩过的坑" class="headerlink" title="2017-09-16-微信服务号绑定踩过的坑"></a>2017-09-16-微信服务号绑定踩过的坑</h1><p>首先绑定域名，方法：</p>
<p>设置–&gt;公众号设置–&gt;功能设置</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-baba10b162ba7a8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>然后可以设置业务域名、JS接口安全域名、网页授权域名。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-dc662ca6e44a805f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>将文件MP<em><em>*</em>.txt（点击下载）[例如wx.qq.com/MP</em><strong><em>.txt；若填写路径，将文件放置在路径目录下，例如wx.qq.com/mp/</em></strong>.txt），并确保可以访问。](<a href="http://0.0.0.1/" target="_blank" rel="noopener">http://0.0.0.1/</a>)</p>
<p>将txt拷贝到Tomcat下域名对应的路径下，配置server.xml，路径：C:\apache-tomcat-7.0.79\webapps\helloworld</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-65f932dda6a3a563.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h1 id="2017-09-16-点击div标签下的href不跳转到目标页面，而是跳转到首页的问题"><a href="#2017-09-16-点击div标签下的href不跳转到目标页面，而是跳转到首页的问题" class="headerlink" title="2017-09-16-点击div标签下的href不跳转到目标页面，而是跳转到首页的问题"></a>2017-09-16-点击div标签下的href不跳转到目标页面，而是跳转到首页的问题</h1><p>a标签如果不做任何定义，点击其中的元素时，会默认跳转到主页。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;&quot; class=&quot;stars&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure></p>
<p>上面点击star星，就会跳转到路径”/“下，解决办法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;javascript:void(0)&quot; class=&quot;stars&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure></p>
<p>原理是：单击此处什么也不要做，让此区域下方的组件处理href事件。</p>
<h1 id="2017-09-16-简单的整数或者小数判断正则表达式"><a href="#2017-09-16-简单的整数或者小数判断正则表达式" class="headerlink" title="2017-09-16-简单的整数或者小数判断正则表达式"></a>2017-09-16-简单的整数或者小数判断正则表达式</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 正则表达式规则：-号出现0或者1次，0-9出现多次，小数点出现0或者1次，0-9出现多次</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNumeric</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (str != <span class="keyword">null</span> &amp;&amp; !str.isEmpty()) &#123;</span><br><span class="line">		Pattern pattern = Pattern.compile(<span class="string">"-?[0-9]*.?[0-9]*"</span>);</span><br><span class="line">		Matcher isNum = pattern.matcher(str);</span><br><span class="line">		<span class="keyword">if</span> (isNum.matches()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2017-09-16-获取页面div下级的innerHtml"><a href="#2017-09-16-获取页面div下级的innerHtml" class="headerlink" title="2017-09-16-获取页面div下级的innerHtml"></a>2017-09-16-获取页面div下级的innerHtml</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://code.jquery.com/jquery-1.10.2.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">getValue</span>(<span class="params"></span>)</span></span></span><br><span class="line"><span class="undefined">&#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> x=<span class="built_in">document</span>.getElementById(<span class="string">"myHeader"</span>)</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> y= $(<span class="string">"#test #myHeader"</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="undefined">alert(x.innerHTML);</span></span><br><span class="line"><span class="undefined">alert(y.innerHTML);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"myHeader"</span> <span class="attr">onclick</span>=<span class="string">"getValue()"</span>&gt;</span>这是标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>点击标题，会提示出它的值。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="2017-09-16-获取高德地图定位的js源码"><a href="#2017-09-16-获取高德地图定位的js源码" class="headerlink" title="2017-09-16-获取高德地图定位的js源码"></a>2017-09-16-获取高德地图定位的js源码</h1><p>Key是我申请的，可以直接用。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">content</span>=<span class="string">"initial-scale=1.0, user-scalable=no, width=device-width"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>浏览器定位<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">href</span>=<span class="string">"http://cache.amap.com/lbs/static/main1119.css"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">src</span>=<span class="string">"http://webapi.amap.com/maps?v=1.3&amp;key=b6df90d2cfda9508fb2106ae6273d7ea"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">src</span>=<span class="string">"http://cache.amap.com/lbs/static/addToolbar.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'container'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"tip"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined">  </span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> map, geolocation;  </span></span><br><span class="line"><span class="javascript">    <span class="comment">//加载地图，调用浏览器定位服务  </span></span></span><br><span class="line"><span class="javascript">    map = <span class="keyword">new</span> AMap.Map(<span class="string">'container'</span>, &#123;  </span></span><br><span class="line"><span class="javascript">        resizeEnable: <span class="literal">true</span>  </span></span><br><span class="line"><span class="undefined">    &#125;);  </span></span><br><span class="line"><span class="javascript">    map.plugin(<span class="string">'AMap.Geolocation'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">        geolocation = <span class="keyword">new</span> AMap.Geolocation(&#123;  </span></span><br><span class="line"><span class="javascript">            enableHighAccuracy: <span class="literal">true</span>,<span class="comment">//是否使用高精度定位，默认:true  </span></span></span><br><span class="line"><span class="javascript">            timeout: <span class="number">10000</span>,          <span class="comment">//超过10秒后停止定位，默认：无穷大  </span></span></span><br><span class="line"><span class="javascript">            buttonOffset: <span class="keyword">new</span> AMap.Pixel(<span class="number">10</span>, <span class="number">20</span>),<span class="comment">//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)  </span></span></span><br><span class="line"><span class="javascript">            zoomToAccuracy: <span class="literal">true</span>,      <span class="comment">//定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false  </span></span></span><br><span class="line"><span class="javascript">            buttonPosition:<span class="string">'RB'</span>  </span></span><br><span class="line"><span class="undefined">        &#125;);  </span></span><br><span class="line"><span class="undefined">        map.addControl(geolocation);  </span></span><br><span class="line"><span class="undefined">        geolocation.getCurrentPosition();  </span></span><br><span class="line"><span class="javascript">        AMap.event.addListener(geolocation, <span class="string">'complete'</span>, onComplete);<span class="comment">//返回定位信息  </span></span></span><br><span class="line"><span class="javascript">        AMap.event.addListener(geolocation, <span class="string">'error'</span>, onError);      <span class="comment">//返回定位出错信息  </span></span></span><br><span class="line"><span class="undefined">    &#125;);  </span></span><br><span class="line"><span class="javascript">    <span class="comment">//解析定位结果  </span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">onComplete</span>(<span class="params">data</span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> str=[<span class="string">'定位成功'</span>];  </span></span><br><span class="line"><span class="javascript">        str.push(<span class="string">'经度：'</span> + data.position.getLng());  </span></span><br><span class="line"><span class="javascript">        str.push(<span class="string">'纬度：'</span> + data.position.getLat());  </span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(data.accuracy)&#123;  </span></span><br><span class="line"><span class="javascript">             str.push(<span class="string">'精度：'</span> + data.accuracy + <span class="string">' 米'</span>);  </span></span><br><span class="line"><span class="javascript">        &#125;<span class="comment">//如为IP精确定位结果则没有精度信息  </span></span></span><br><span class="line"><span class="javascript">        str.push(<span class="string">'是否经过偏移：'</span> + (data.isConverted ? <span class="string">'是'</span> : <span class="string">'否'</span>));  </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> point = data.position.getLng()+<span class="string">","</span>+data.position.getLat();  </span></span><br><span class="line"><span class="undefined">        poiToaddress(point);  </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'tip'</span>).innerHTML = str.join(<span class="string">'&lt;br&gt;'</span>);  </span></span><br><span class="line"><span class="undefined">    &#125;  </span></span><br><span class="line"><span class="javascript">    <span class="comment">//解析定位错误信息  </span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">data</span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'tip'</span>).innerHTML = <span class="string">'定位失败'</span>;  </span></span><br><span class="line"><span class="undefined">    &#125;  </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">//坐标点转地址  </span></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">poiToaddress</span>(<span class="params">poi</span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">    AMap.plugin([<span class="string">"AMap.Geocoder"</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> geocoder = <span class="keyword">new</span> AMap.Geocoder(&#123;  </span></span><br><span class="line"><span class="javascript">            city: <span class="string">"0315"</span>, <span class="comment">//城市，默认：“全国”  </span></span></span><br><span class="line"><span class="javascript">            radius: <span class="number">500</span> <span class="comment">//范围，默认：500,以已知坐标为中心点，radius为半径，返回范围内兴趣点和道路信息   </span></span></span><br><span class="line"><span class="undefined">        &#125;);  </span></span><br><span class="line"><span class="javascript">        geocoder.getAddress(poi, <span class="function"><span class="keyword">function</span> (<span class="params">status, result</span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (status === <span class="string">'complete'</span> &amp;&amp; result.info === <span class="string">'OK'</span>) &#123;  </span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> address = result.regeocode.formattedAddress; <span class="comment">//返回地址描述  </span></span></span><br><span class="line"><span class="undefined">                address2point(address);   </span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"地址：："</span>+address); </span></span><br><span class="line"><span class="javascript">                alert(<span class="string">"当前地址:"</span> + address);</span></span><br><span class="line"><span class="undefined">            &#125;  </span></span><br><span class="line"><span class="undefined">        &#125;);  </span></span><br><span class="line"><span class="undefined">    &#125;)  </span></span><br><span class="line"><span class="undefined">&#125;  </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">//地址转坐标  </span></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">address2point</span>(<span class="params">address</span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">    AMap.plugin([<span class="string">"AMap.Geocoder"</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> geocoder = <span class="keyword">new</span> AMap.Geocoder(&#123;  </span></span><br><span class="line"><span class="javascript">            city: <span class="string">"0315"</span>, <span class="comment">//城市，默认：“全国”  </span></span></span><br><span class="line"><span class="javascript">            radius: <span class="number">500</span> <span class="comment">//范围，默认：500,以已知坐标为中心点，radius为半径，返回范围内兴趣点和道路信息   </span></span></span><br><span class="line"><span class="undefined">        &#125;);  </span></span><br><span class="line"><span class="javascript">        geocoder.getLocation(address, <span class="function"><span class="keyword">function</span> (<span class="params">status, result</span>) </span>&#123;  </span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (status === <span class="string">'complete'</span> &amp;&amp; result.info === <span class="string">'OK'</span>) &#123;  </span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> geocode = result.geocodes[<span class="number">0</span>];  </span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> resultStr = geocode.location.lng + <span class="string">","</span> + geocode.location.lat;  </span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(resultStr);  </span></span><br><span class="line"><span class="javascript">                alert(<span class="string">"resultStr"</span> + resultStr);</span></span><br><span class="line"><span class="undefined">            &#125;  </span></span><br><span class="line"><span class="undefined">        &#125;);  </span></span><br><span class="line"><span class="undefined">    &#125;)  </span></span><br><span class="line"><span class="undefined">&#125;  </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-解析微信xml消息使用的jar包"><a href="#2017-09-16-解析微信xml消息使用的jar包" class="headerlink" title="2017-09-16-解析微信xml消息使用的jar包"></a>2017-09-16-解析微信xml消息使用的jar包</h1><p><img src="http://upload-images.jianshu.io/upload_images/1124873-6f7b3a17448680ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>使用XStream，下载地址：<a href="http://x-stream.github.io/download.html" target="_blank" rel="noopener">XStream - Download</a></p>
<p>从里面找上门的3个jar包并加载。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-44a216ef633567ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="2017-09-16-css图片资源加载失败？"><a href="#2017-09-16-css图片资源加载失败？" class="headerlink" title="2017-09-16-css图片资源加载失败？"></a>2017-09-16-css图片资源加载失败？</h1><p>之前的css代码是这样写（资源使用的是绝对路径）：</p>
<p>background: url(resources/img/star2.png) no-repeat !important;</p>
<p>结果报资源找不见：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zepto.min.js:1 GET http://localhost:8080/helloworld/resources/static/css/resources/img/star2.png 404 (Not Found)</span><br></pre></td></tr></table></figure></p>
<p>图片加载失败，找了一下，这个位置其实是有这个文件的：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-0acdf02e655a6b21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>改成相对路径就好了：</p>
<p>background: url(../img/star2.png) no-repeat !important;</p>
<h1 id="2017-09-16-Eclipse-Java-EE找不到JSTL"><a href="#2017-09-16-Eclipse-Java-EE找不到JSTL" class="headerlink" title="2017-09-16-Eclipse-Java-EE找不到JSTL"></a>2017-09-16-Eclipse-Java-EE找不到JSTL</h1><p>在Eclipse下提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Can not find the tag library descriptor for “http://java.sun.com/jsp/jstl/core”</span><br></pre></td></tr></table></figure></p>
<p>访问对应的页面时，console控制台提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The absolute uri: [http://java.sun.com/jsp/jstl/core] cannot be resolved in either web.xml or the jar files deployed with this application</span><br></pre></td></tr></table></figure></p>
<p>从Tomcat官网去下载JSTL jar包，链接是：<a href="http://tomcat.apache.org/download-taglibs.cgi" target="_blank" rel="noopener">Apache Taglibs Downloads</a></p>
<p>注意这4个都下载：</p>
<p>拷贝下载后的文件到tomcat lib下，如图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-cafa812c337b9dda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>右键点击Eclipse下对应的Project，Build path –&gt; Config Build Path，进入Liabraries标签页，添加Liabrary，如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-354645d04b4f8dea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-800011f6576c5459.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h1 id="2017-09-16-Eclipse-Java-EE-IDE修改web项目部署路径"><a href="#2017-09-16-Eclipse-Java-EE-IDE修改web项目部署路径" class="headerlink" title="2017-09-16-Eclipse-Java-EE-IDE修改web项目部署路径"></a>2017-09-16-Eclipse-Java-EE-IDE修改web项目部署路径</h1><p>如果添加了项目到tomcat下那么按照下面的步骤进行配置</p>
<p>1、找到Server面板，右击当前的那个Tomcat，先remove掉其中所有的工程。 </p>
<p>2、再右击那个Tomcat，选择Clean，清空一下。 </p>
<p>注意：只有clean之后，才能编辑Server Locations。</p>
<p>3、双击那个Tomcat，会打开属性面板，找到左边第二个Server Locations。 </p>
<p>选择第二个会在Tomcat路径下创建一个名为wtpwebapps文件夹，存放Tomcat发布的web项目；</p>
<p>选择第三个，你可以在Server Path中输入你想要的路径，保存即可。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-71fc1135d5c7fd27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>然后右击Server，Add and Remove…就可以添加项目来试试看了。</p>
<h1 id="2017-09-16-EL表达式，结果取整"><a href="#2017-09-16-EL表达式，结果取整" class="headerlink" title="2017-09-16-EL表达式，结果取整"></a>2017-09-16-EL表达式，结果取整</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;8/7&#125;&quot; maxFractionDigits=&quot;0&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>其中maxFractionDigits=”0”表示保留0位小数，这样就可以实现取整了。同时这里是按照四舍五入的规则来进行取整的。如果是${2/6}结果就是0，如果是${6/7}结果就是1。<br>在这里我们同样也可以设置保留n为小数，仅需要设置maxFractionDigits=”n”即可实现。</p>
<h1 id="2017-09-16-Form表单提交后不跳转到新页面"><a href="#2017-09-16-Form表单提交后不跳转到新页面" class="headerlink" title="2017-09-16-Form表单提交后不跳转到新页面"></a>2017-09-16-Form表单提交后不跳转到新页面</h1><p>去掉form表单的这个属性：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target='hiddenwin'</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-hibernate-hql实战小结"><a href="#2017-09-16-hibernate-hql实战小结" class="headerlink" title="2017-09-16-hibernate-hql实战小结"></a>2017-09-16-hibernate-hql实战小结</h1><h2 id="表关联查询汇总排名"><a href="#表关联查询汇总排名" class="headerlink" title="表关联查询汇总排名"></a>表关联查询汇总排名</h2><ul>
<li>查询报名记录<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> o.id <span class="keyword">as</span> <span class="keyword">id</span>, o.name <span class="keyword">as</span> org_name <span class="keyword">from</span> t_sign_up t, t_student s, t_org o <span class="keyword">where</span> t.student_id = s.id <span class="keyword">and</span> s.org_id=o.id</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>结果如下，可以看到1个单位下有4条报名记录，另外一个单位下有2条：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-83d673bac43cee6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ul>
<li>汇总报名记录，并按照统计次数降序：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> o.id <span class="keyword">as</span> <span class="keyword">id</span>, o.name <span class="keyword">as</span> org_name, <span class="keyword">count</span>(t.id) <span class="keyword">as</span> org_count <span class="keyword">from</span> t_sign_up t, t_student s, t_org o <span class="keyword">where</span> t.student_id = s.id <span class="keyword">and</span> s.org_id=o.id <span class="keyword">group</span> <span class="keyword">by</span> o.name <span class="keyword">order</span> <span class="keyword">by</span> org_count <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>效果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-8cd2d1ba3f10662f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<blockquote>
<p>如上sql，在Mysql测试成功，移植到hql时，需要给经过重名的orgCount加上引号，否则会报出现报错，报找不到orgCount字段，如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> o.id <span class="keyword">as</span> <span class="keyword">id</span>, o.name <span class="keyword">as</span> orgName, <span class="keyword">count</span>(t.id) <span class="keyword">as</span> orgCount <span class="keyword">from</span> SignUp t, Student s, Org o <span class="keyword">where</span> t.studentId = s.id <span class="keyword">and</span> s.orgId=o.id <span class="keyword">group</span> <span class="keyword">by</span> o.name <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">'orgCount'</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>数据比较多的时候，需要进行分页展示，相关的，我们要构建countQuery来查询结果总数目，在如上的sql上进行统计，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String countQuery = <span class="string">"select count(*) from (select o.id as id, o.name as orgName, count(t.id) as orgCount from SignUp t, Student s, Org o where t.studentId = s.id and s.orgId=o.id group by o.name) as result"</span></span><br></pre></td></tr></table></figure></p>
<p>执行过程中，会报错：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">九月 08, 2017 3:22:22 下午 org.hibernate.hql.ast.ErrorCounter reportError</span><br><span class="line">严重: line 1:61: unexpected token: count</span><br><span class="line">ERROR 2017 09 08 15:22:22 com.opensymphony.xwork2.util.logging.commons.CommonsLogger.error(CommonsLogger.java:42) Exception occurred during processing request: unexpected token: ( near line 1, column 22 [select count(*) from (select o.id as id, o.name as orgName, count(t.id) as orgCount from com.lmscn.lms.model.SignUp t, com.lmscn.lms.model.Student s, com.lmscn.lms.model.Org o where t.studentId = s.id and s.orgId=o.id group by o.name) as result]; nested exception is org.hibernate.hql.ast.QuerySyntaxException: unexpected token: ( near line 1, column 22 [select count(*) from (select o.id as id, o.name as orgName, count(t.id) as orgCount from com.lmscn.lms.model.SignUp t, com.lmscn.lms.model.Student s, com.lmscn.lms.model.Org o where t.studentId = s.id and s.orgId=o.id group by o.name) as result] </span><br><span class="line">org.springframework.orm.hibernate3.HibernateQueryException: unexpected token: ( near line 1, column 22 [select count(*) from (select o.id as id, o.name as orgName, count(t.id) as orgCount from com.lmscn.lms.model.SignUp t, com.lmscn.lms.model.Student s, com.lmscn.lms.model.Org o where t.studentId = s.id and s.orgId=o.id group by o.name) as result]; nested exception is org.hibernate.hql.ast.QuerySyntaxException: unexpected token: ( near line 1, column 22 [select count(*) from (select o.id as id, o.name as orgName, count(t.id) as orgCount from com.lmscn.lms.model.SignUp t, com.lmscn.lms.model.Student s, com.lmscn.lms.model.Org o where t.studentId = s.id and s.orgId=o.id group by o.name) as result]</span><br><span class="line">	at org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:660)</span><br><span class="line">	at org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)</span><br><span class="line">	at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:411)</span><br><span class="line">	at org.springframework.orm.hibernate3.HibernateTemplate.execute(HibernateTemplate.java:339)</span><br><span class="line">	at javacommon.base.BaseHibernateDao$PageQueryUtils.pageQuery(BaseHibernateDao.java:151)</span><br><span class="line">	at javacommon.base.BaseHibernateDao$PageQueryUtils.access$1(BaseHibernateDao.java:147)</span><br><span class="line">	at javacommon.base.BaseHibernateDao.pageQuery(BaseHibernateDao.java:121)</span><br></pre></td></tr></table></figure></p>
<p>还是hibernate解析过程中出了问题，主要是对中间产生的<code>result虚拟临时表</code>没有办法识别，难道这就要放弃，只能使用JDBC来进行分页了？<br>不然！经过思考，我们统计count的目的就是为了得到总数，也有一个折中的办法，如下：<br>使用distinct进行去重，这样查到两条记录（也就是说共有两个单位），如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> o.id) <span class="keyword">from</span> t_sign_up t, t_student s, t_org o <span class="keyword">where</span> t.student_id = s.id <span class="keyword">and</span> s.org_id=o.id</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-03c9e1c9357fca5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>转换成hql，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String countQuery = <span class="string">"select count(distinct o.id) from SignUp t, Student s, Org o where t.studentId = s.id and s.orgId=o.id"</span>;</span><br></pre></td></tr></table></figure></p>
<p>结果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-7fd98d52457fcce1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>可以看到，分页成功了：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-90098979794f271c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="2017-09-16-java去除HTML标签"><a href="#2017-09-16-java去除HTML标签" class="headerlink" title="2017-09-16-java去除HTML标签"></a>2017-09-16-java去除HTML标签</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 过滤html标签</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> htmlStr</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> String <span class="title">delHTMLTag</span><span class="params">(String htmlStr)</span></span>&#123; </span><br><span class="line">     String regEx_script=<span class="string">"&lt;script[^&gt;]*?&gt;[\\s\\S]*?&lt;\\/script&gt;"</span>; <span class="comment">//定义script的正则表达式 </span></span><br><span class="line">     String regEx_style=<span class="string">"&lt;style[^&gt;]*?&gt;[\\s\\S]*?&lt;\\/style&gt;"</span>; <span class="comment">//定义style的正则表达式 </span></span><br><span class="line">     String regEx_html=<span class="string">"&lt;[^&gt;]+&gt;"</span>; <span class="comment">//定义HTML标签的正则表达式 </span></span><br><span class="line"></span><br><span class="line">     Pattern p_script=Pattern.compile(regEx_script,Pattern.CASE_INSENSITIVE); </span><br><span class="line">     Matcher m_script=p_script.matcher(htmlStr); </span><br><span class="line">     htmlStr=m_script.replaceAll(<span class="string">""</span>); <span class="comment">//过滤script标签 </span></span><br><span class="line"></span><br><span class="line">     Pattern p_style=Pattern.compile(regEx_style,Pattern.CASE_INSENSITIVE); </span><br><span class="line">     Matcher m_style=p_style.matcher(htmlStr); </span><br><span class="line">     htmlStr=m_style.replaceAll(<span class="string">""</span>); <span class="comment">//过滤style标签 </span></span><br><span class="line"></span><br><span class="line">     Pattern p_html=Pattern.compile(regEx_html,Pattern.CASE_INSENSITIVE); </span><br><span class="line">     Matcher m_html=p_html.matcher(htmlStr); </span><br><span class="line">     htmlStr=m_html.replaceAll(<span class="string">""</span>); <span class="comment">//过滤html标签 </span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> htmlStr.trim(); <span class="comment">//返回文本字符串 </span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h1 id="2017-09-16-java字符串保存到Mysql中文乱码问题"><a href="#2017-09-16-java字符串保存到Mysql中文乱码问题" class="headerlink" title="2017-09-16-java字符串保存到Mysql中文乱码问题"></a>2017-09-16-java字符串保存到Mysql中文乱码问题</h1><p>最近遇到java中设置中文字符串到Mysql出现中文乱码问题。<br>之前的数据库链接是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbcUrl=jdbc:mysql://192.168.1.123:3306/mydb?zeroDateTimeBehavior=convertToNull</span><br></pre></td></tr></table></figure></p>
<p>改成如下就好了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbcUrl=jdbc:mysql://192.168.1.123:3306/mydb?zeroDateTimeBehavior=convertToNull&amp;useUnicode=true&amp;characterEncoding=utf-8</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-java获取当天24点"><a href="#2017-09-16-java获取当天24点" class="headerlink" title="2017-09-16-java获取当天24点"></a>2017-09-16-java获取当天24点</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Calendar calendar = Calendar.getInstance();</span><br><span class="line">	    calendar.setTime(<span class="keyword">new</span> Date());</span><br><span class="line">	    calendar.set(Calendar.HOUR_OF_DAY, <span class="number">24</span>);</span><br><span class="line">	    calendar.set(Calendar.MINUTE, <span class="number">0</span>);</span><br><span class="line">	    calendar.set(Calendar.SECOND, <span class="number">0</span>);</span><br><span class="line"> Date start = calendar.getTime();</span><br></pre></td></tr></table></figure>
<h1 id="2017-09-16-Java-获取指定日期之前或者之后的多少分钟"><a href="#2017-09-16-Java-获取指定日期之前或者之后的多少分钟" class="headerlink" title="2017-09-16 Java 获取指定日期之前或者之后的多少分钟"></a>2017-09-16 Java 获取指定日期之前或者之后的多少分钟</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算指定日期之前或者之后的多少分钟</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> minute</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTimeByMinute</span><span class="params">(Date date, <span class="keyword">int</span> minute)</span> </span>&#123;</span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line">        calendar.setTime(date);</span><br><span class="line">        calendar.add(Calendar.MINUTE, minute);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>).format(calendar.getTime());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="2017-09-16-java-获取编码转换为utf-8"><a href="#2017-09-16-java-获取编码转换为utf-8" class="headerlink" title="2017-09-16-java-获取编码转换为utf-8"></a>2017-09-16-java-获取编码转换为utf-8</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	address = <span class="keyword">new</span> String(address.getBytes(<span class="string">"ISO-8859-1"</span>),<span class="string">"UTF-8"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2017-09-16-微信消息解析用到的Java-enum-枚举"><a href="#2017-09-16-微信消息解析用到的Java-enum-枚举" class="headerlink" title="2017-09-16 微信消息解析用到的Java  enum 枚举"></a>2017-09-16 微信消息解析用到的Java  enum 枚举</h1><p>微信取得消息类型的时候会报错：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取得消息类型  </span></span><br><span class="line">String msgType = inputMsg.getMsgType();</span><br><span class="line">WXEventType.MsgType key = WXEventType.MsgType.valueOf(msgType);</span><br><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line"><span class="keyword">case</span> WXEventType.MsgType.event:</span><br><span class="line"></span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>报错如下：<br><img src="http://upload-images.jianshu.io/upload_images/1124873-c558efa9d3b64800.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The qualified case label WXEventType.MsgType.event must be replaced with the unqualified enum constant event</span><br></pre></td></tr></table></figure>
<p>定义中是有的，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">	<span class="comment">// / 消息类型枚举</span></span><br><span class="line">	<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">enum</span> MsgType &#123;</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// /文本类型</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		text,</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// / 图片类型</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		IMAGE,</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// / 语音类型</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		VOICE,</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// / 视频类型</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		VIDEO,</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// / 地理位置类型</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		location,</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// / 链接类型</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		LINK,</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// / 事件类型</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		event,</span><br><span class="line">		<span class="comment">// / &lt;summary&gt;</span></span><br><span class="line">		<span class="comment">// / 小视频</span></span><br><span class="line">		<span class="comment">// / &lt;/summary&gt;</span></span><br><span class="line">		SHORTVIDEO</span><br><span class="line">	&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>解决办法，删除WXEventType.MsgType，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取得消息类型  </span></span><br><span class="line">String msgType = inputMsg.getMsgType();</span><br><span class="line">WXEventType.MsgType key = WXEventType.MsgType.valueOf(msgType);</span><br><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line"><span class="keyword">case</span> event:</span><br><span class="line"></span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-Java-Integer自增"><a href="#2017-09-16-Java-Integer自增" class="headerlink" title="2017-09-16-Java-Integer自增"></a>2017-09-16-Java-Integer自增</h1><p>Java Integer 类的对象创建之后他的值就不能被修改，在 Integer ++ 的时候Integer是创建一个新的对象<br>如果要自增，怎么办呢？<br>可以这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(AtomicInteger index)</span> </span>&#123;</span><br><span class="line">  signUpStudentNum.getAndIncrement();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-JFinal传递map到JSP页面中"><a href="#2017-09-16-JFinal传递map到JSP页面中" class="headerlink" title="2017-09-16-JFinal传递map到JSP页面中"></a>2017-09-16-JFinal传递map到JSP页面中</h1><ol>
<li><p>封装map</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; responseInfoMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">responseInfoMap.put(<span class="string">"testInfo"</span>, testInfo);</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setAttr(<span class="string">"commentListInfo"</span>, responseInfoMap);</span><br><span class="line">renderJsp(<span class="string">"/WEB-INF/jsp/helloworld/hello.jsp"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>JSP页面通过EL表达式获取</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;commentListInfo.testInfo.title&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="2017-09-16-JFinal使用WebSocket"><a href="#2017-09-16-JFinal使用WebSocket" class="headerlink" title="2017-09-16-JFinal使用WebSocket"></a>2017-09-16-JFinal使用WebSocket</h1><p>1、先建立一个Maven项目，如果是老项目，也可转成maven项目，参见我之前写的一篇帮助：<br><a href="http://www.jianshu.com/p/5781cea865a3" target="_blank" rel="noopener">Myeclipse普通java项目转maven项目</a></p>
<p>2、pom.xml引用相关jar包，1.7之后支持，配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  		&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">			&lt;groupId&gt;javax.websocket&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">			&lt;artifactId&gt;javax.websocket-api&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">			&lt;version&gt;1.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">			&lt;scope&gt;provided&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">		&lt;/dependency&gt; --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javaee-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>tomcat7和jave EE 1.7都支持，注意引用一个，不要重复。</p>
<p>3、编写事件拦截处理代码：<br>ZhiWebSocketHandler.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yyxz.main;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jfinal.handler.Handler;</span><br><span class="line"><span class="keyword">import</span> com.jfinal.kit.StrKit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhiWebSocketHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Pattern filterUrlRegxPattern;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ZhiWebSocketHandler</span><span class="params">(String filterUrlRegx)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (StrKit.isBlank(filterUrlRegx))</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The para filterUrlRegx can not be blank."</span>);</span><br><span class="line">		filterUrlRegxPattern = Pattern.compile(filterUrlRegx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String target, HttpServletRequest request, HttpServletResponse response, <span class="keyword">boolean</span>[] isHandled)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">if</span> (filterUrlRegxPattern.matcher(target).find())</span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			next.handle(target, request, response, isHandled);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在JFinal Config中进行注册：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span> <span class="keyword">extends</span> <span class="title">JFinalConfig</span> </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configHandler</span><span class="params">(Handlers me)</span> </span>&#123;</span><br><span class="line">		me.add(<span class="keyword">new</span> ContextPathHandler(<span class="string">"ctx"</span>));</span><br><span class="line">		me.add(<span class="keyword">new</span> ZhiWebSocketHandler(<span class="string">"^/websocket"</span>));</span><br><span class="line"><span class="comment">// 也可以使用UrlSkipHandler，就不用编写Handler处理类了</span></span><br><span class="line"><span class="comment">//		me.add(new UrlSkipHandler("^/websocket", false));</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4、后台监听websocket代码：<br>WebSocketController.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yyxz.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnClose;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnMessage;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnOpen;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.Session;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerEndpoint</span>(<span class="string">"/websocket"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketController</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WebSocketController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">" WebSocket init~~~"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@OnOpen</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"onOpen"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@OnClose</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"onClose"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//	@OnError</span></span><br><span class="line"><span class="comment">//	public void onError(Session session) &#123;</span></span><br><span class="line"><span class="comment">//		System.out.println("onError");</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@OnMessage</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String requestJson, Session session)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		requestJson = <span class="string">"一一小知回复："</span> + requestJson; </span><br><span class="line">		System.out.println(requestJson);</span><br><span class="line">		session.getBasicRemote().sendText(requestJson);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5、在前端发起，编写页面：<br>webSocketTest.jsp<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- for HTML5 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Java后端WebSocket的Tomcat实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	Welcome</span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"text"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span>发送消息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"closeWebSocket()"</span>&gt;</span>关闭WebSocket连接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"message"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> websocket = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//判断当前浏览器是否支持WebSocket</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="string">'WebSocket'</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span></span><br><span class="line"><span class="javascript">        websocket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:8080/yiyixiaozhi/websocket"</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">'当前浏览器 Not support websocket'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//连接发生错误的回调方法</span></span></span><br><span class="line"><span class="javascript">    websocket.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        setMessageInnerHTML(<span class="string">"WebSocket连接发生错误"</span>);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//连接成功建立的回调方法</span></span></span><br><span class="line"><span class="javascript">    websocket.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        setMessageInnerHTML(<span class="string">"WebSocket连接成功"</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//接收到消息的回调方法</span></span></span><br><span class="line"><span class="javascript">    websocket.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        setMessageInnerHTML(event.data);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//连接关闭的回调方法</span></span></span><br><span class="line"><span class="javascript">    websocket.onclose = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        setMessageInnerHTML(<span class="string">"WebSocket连接关闭"</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onbeforeunload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        closeWebSocket();</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//将消息显示在网页上</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">setMessageInnerHTML</span>(<span class="params">innerHTML</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'message'</span>).innerHTML += innerHTML + <span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//关闭WebSocket连接</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">closeWebSocket</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        websocket.close();</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//发送消息</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> message = <span class="built_in">document</span>.getElementById(<span class="string">'text'</span>).value;</span></span><br><span class="line"><span class="undefined">        websocket.send(message);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-2dc1c92a826514f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-d87b1cb465fc58d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="2017-09-16-JFinal-Controller中forwardAction的使用"><a href="#2017-09-16-JFinal-Controller中forwardAction的使用" class="headerlink" title="2017-09-16-JFinal-Controller中forwardAction的使用"></a>2017-09-16-JFinal-Controller中forwardAction的使用</h1><p>请求转发使用forwardAction，请求参数会带过去，不要在请求中带参数，比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forwardAction(<span class="string">"/api/test/toPage?openId=1"</span>);</span><br></pre></td></tr></table></figure></p>
<p>正确的写法是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forwardAction(&quot;/api/test/toPage&quot;);</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-js中的“中文汉字”传到到java端乱码问题解决"><a href="#2017-09-16-js中的“中文汉字”传到到java端乱码问题解决" class="headerlink" title="2017-09-16-js中的“中文汉字”传到到java端乱码问题解决"></a>2017-09-16-js中的“中文汉字”传到到java端乱码问题解决</h1><p>使用的是高德地图，获取到中文地址后，传递到java端显示乱码，如何解决呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String address = getPara(<span class="string">"address"</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	address = <span class="keyword">new</span> String(address.getBytes(<span class="string">"ISO-8859-1"</span>),<span class="string">"UTF-8"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-Mac批量重命名文件"><a href="#2017-09-16-Mac批量重命名文件" class="headerlink" title="2017-09-16-Mac批量重命名文件"></a>2017-09-16-Mac批量重命名文件</h1><p>统一给文件加前缀，示例如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bianxh:2 bianxh$ ll</span><br><span class="line">total 264</span><br><span class="line">drwxr-xr-x  33 bianxh  staff  1122  9 16 13:43 .</span><br><span class="line">drwxr-xr-x   9 bianxh  staff   306  9 16 13:44 ..</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   397  9 16 12:26 EL表达式，结果取整.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   801  9 16 12:26 Eclipse-Java-EE-IDE修改web项目部署路径.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff  2607  9 16 12:27 小结：使用正则表达式提取时间中的数字.md</span><br><span class="line">bianxh:2 bianxh$ <span class="keyword">for</span> var <span class="keyword">in</span> *.md; <span class="keyword">do</span> mv <span class="string">"<span class="variable">$var</span>"</span> <span class="string">"2017-09-16-<span class="variable">$&#123;var%.md&#125;</span>.md"</span>;  <span class="keyword">done</span></span><br><span class="line">bianxh:2 bianxh$ ll</span><br><span class="line">total 264</span><br><span class="line">drwxr-xr-x  33 bianxh  staff  1122  9 16 13:44 .</span><br><span class="line">drwxr-xr-x   9 bianxh  staff   306  9 16 13:44 ..</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   397  9 16 12:26 2017-09-16-EL表达式，结果取整.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   801  9 16 12:26 2017-09-16-Eclipse-Java-EE-IDE修改web项目部署路径.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff  2607  9 16 12:27 2017-09-16-小结：使用正则表达式提取时间中的数字.md</span><br></pre></td></tr></table></figure></p>
<p>还有替换啊什么的，一些高级用法，参见：<br><a href="https://my.oschina.net/musings/blog/380939" target="_blank" rel="noopener">https://my.oschina.net/musings/blog/380939</a></p>
<p>比如，假如文件名称中有多个后缀怎么办呢？如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">bianxh:一一小知的副本 bianxh$ ll</span><br><span class="line">total 336</span><br><span class="line">drwxr-xr-x  32 bianxh  staff   1088  9 16 14:04 .</span><br><span class="line">drwxr-xr-x   6 bianxh  staff    204  9 16 13:59 ..</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   6148  9 16 13:21 .DS_Store</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    501  9 16 12:26 2015-09-16-git代码仓库如何迁移.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3149  9 16 12:26 2015-12-18-读笔记：公司高速发展是对团队最好的管理.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3014  9 16 12:26 2015-6-2-2-如何“有效地一对一会谈”.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   7447  9 16 12:26 2016-09-16-OSChina git 代码fork及PR指南.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    163  9 16 13:24 2016-09-16-空谷幽兰-第六章-登天之道-第二节.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   2159  9 16 12:26 2016-1-10-吐槽招商银行营业厅，赞一下微信客服.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3898  9 16 12:26 2016-1-16-Hunt.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1854  9 16 12:26 2016-1-17：喜欢？电子书：纸质书.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3708  9 16 12:26 2016-1-25：新时代的企业架构师.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1298  9 16 12:26 2016-1-26：实践应当从业务需求出发.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1676  9 16 12:26 2016-1-28：图像压缩技术？Lena.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    661  9 16 12:26 2016-1-28：项目经理？产品经理.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3076  9 16 12:26 2016-10-11-内置对象.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    572  9 16 12:26 2016-12-1-空谷幽兰-第六章-登天之道-第三节.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   2464  9 16 12:26 2016-12-5-坚持很难.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1298  9 16 12:26 2016-2-5-对OKRs粗浅的理解.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1129  9 16 12:26 2016-4-25：软件模块的3项职责.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   2126  9 16 12:26 2016-4-27：我眼中“项目经理”需要知道的.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   8678  9 16 12:26 2016-5-10-“深淘滩，低作堰”-华为公司的战略创新和机制创新.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    760  9 16 12:26 2016-5-3-曲江海洋馆简游.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff  10040  9 16 12:26 2016-5-4-樊登速读-重新定义公司.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    802  9 16 12:26 2016-6-14-端午节日小记.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    422  9 16 12:26 2016-6-15：刺猬心态.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    829  9 16 12:26 2016-6-16：球队思维.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1011  9 16 12:26 2016-6-19：没有什么不同.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   6380  9 16 12:26 2016-7-6-OKR管理方法.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   7415  9 16 12:26 2016-9-9-[焦英俊]-阿里巴巴店铺的十年技术演变之路.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   8300  9 16 12:26 2017-2-1-每个程序员都应读的10本经典书籍.md.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   8833  9 16 13:25 2017-4-1-JSP.md.md</span><br><span class="line">bianxh:一一小知的副本 bianxh$ rename <span class="string">'s/\.md.md$/\.md/'</span> *.md</span><br><span class="line">bianxh:一一小知的副本 bianxh$ ll</span><br><span class="line">total 336</span><br><span class="line">drwxr-xr-x  32 bianxh  staff   1088  9 16 14:05 .</span><br><span class="line">drwxr-xr-x   6 bianxh  staff    204  9 16 13:59 ..</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   6148  9 16 13:21 .DS_Store</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    501  9 16 12:26 2015-09-16-git代码仓库如何迁移.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3149  9 16 12:26 2015-12-18-读笔记：公司高速发展是对团队最好的管理.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3014  9 16 12:26 2015-6-2-2-如何“有效地一对一会谈”.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   7447  9 16 12:26 2016-09-16-OSChina git 代码fork及PR指南.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    163  9 16 13:24 2016-09-16-空谷幽兰-第六章-登天之道-第二节.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   2159  9 16 12:26 2016-1-10-吐槽招商银行营业厅，赞一下微信客服.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3898  9 16 12:26 2016-1-16-Hunt.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1854  9 16 12:26 2016-1-17：喜欢？电子书：纸质书.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3708  9 16 12:26 2016-1-25：新时代的企业架构师.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1298  9 16 12:26 2016-1-26：实践应当从业务需求出发.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1676  9 16 12:26 2016-1-28：图像压缩技术？Lena.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    661  9 16 12:26 2016-1-28：项目经理？产品经理.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   3076  9 16 12:26 2016-10-11-内置对象.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    572  9 16 12:26 2016-12-1-空谷幽兰-第六章-登天之道-第三节.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   2464  9 16 12:26 2016-12-5-坚持很难.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1298  9 16 12:26 2016-2-5-对OKRs粗浅的理解.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1129  9 16 12:26 2016-4-25：软件模块的3项职责.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   2126  9 16 12:26 2016-4-27：我眼中“项目经理”需要知道的.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   8678  9 16 12:26 2016-5-10-“深淘滩，低作堰”-华为公司的战略创新和机制创新.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    760  9 16 12:26 2016-5-3-曲江海洋馆简游.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff  10040  9 16 12:26 2016-5-4-樊登速读-重新定义公司.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    802  9 16 12:26 2016-6-14-端午节日小记.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    422  9 16 12:26 2016-6-15：刺猬心态.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff    829  9 16 12:26 2016-6-16：球队思维.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   1011  9 16 12:26 2016-6-19：没有什么不同.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   6380  9 16 12:26 2016-7-6-OKR管理方法.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   7415  9 16 12:26 2016-9-9-[焦英俊]-阿里巴巴店铺的十年技术演变之路.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   8300  9 16 12:26 2017-2-1-每个程序员都应读的10本经典书籍.md</span><br><span class="line">-rw-r--r--@  1 bianxh  staff   8833  9 16 13:25 2017-4-1-JSP.md</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-MAC通过Microsoft-Remote-Desktop控制windows按键找回"><a href="#2017-09-16-MAC通过Microsoft-Remote-Desktop控制windows按键找回" class="headerlink" title="2017-09-16-MAC通过Microsoft-Remote-Desktop控制windows按键找回"></a>2017-09-16-MAC通过Microsoft-Remote-Desktop控制windows按键找回</h1><p>由于MAC默认将F1、F2等按键使用了。所以正常情况下，需要通过fn+F1、F2等实现正常windows系统上的按键效果。</p>
<p>这个按键功能如果要和windows体验一致，操作如下：</p>
<p>系统偏好设置–&gt;键盘：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-70c2b4a3ae92c5ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>但是发现还有F11、F12无法使用，比如在Chrome调试过程中，由于要使用F12键来调出开发者工具。解决办法如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-40b69d61d2279d1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>好，我们来在Mac下远程连接Windows，打开Chrome浏览器试试：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-a957438d8596d89d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h1 id="2017-09-16-Mac-下安装Java-EE"><a href="#2017-09-16-Mac-下安装Java-EE" class="headerlink" title="2017-09-16-Mac-下安装Java-EE"></a>2017-09-16-Mac-下安装Java-EE</h1><p>下载的是：sh文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bianxh:java_ee_sdk bianxh$ sudo chmod +x ./java_ee_sdk-7-jdk7-macosx-x64-ml.sh</span><br><span class="line">bianxh:java_ee_sdk bianxh$ ./java_ee_sdk-7-jdk7-macosx-x64-ml.sh </span><br><span class="line">This program requires DISPLAY environment variable to be set.</span><br><span class="line">Please re-run after assigning an appropriate value to DISPLAY.</span><br><span class="line">bianxh:java_ee_sdk bianxh$ DISPLAY=:0 ./java_ee_sdk-7-jdk7-macosx-x64-ml.sh </span><br><span class="line">Extracting the installer archive...</span><br><span class="line">Extracting the installer runtime...</span><br><span class="line">Extracting the installer resources...</span><br><span class="line">Extracting the installer metadata...</span><br><span class="line"></span><br><span class="line">Welcome to GlassFish installer</span><br><span class="line"></span><br><span class="line">Using the user defined JAVA_HOME : /Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home</span><br><span class="line">Entering setup...</span><br><span class="line">SwixML 1.5 (#144)</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-Mac-安装多个jdk踩过的坑"><a href="#2017-09-16-Mac-安装多个jdk踩过的坑" class="headerlink" title="2017-09-16-Mac-安装多个jdk踩过的坑"></a>2017-09-16-Mac-安装多个jdk踩过的坑</h1><p>我是先安装了jdk 8，然后安装了jdk7，通过命令可以看到，默认链接的是jdk8<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bianxh:Versions bianxh$ which java</span><br><span class="line">/usr/bin/java</span><br><span class="line">bianxh:Versions bianxh$ ls -l /usr/bin/java</span><br><span class="line">lrwxr-xr-x  1 root  wheel  74  9 22  2016 /usr/bin/java -&gt; /System/Library/Frameworks/JavaVM.framework/Versions/Current/Commands/java</span><br><span class="line">bianxh:Versions bianxh$ /usr/libexec/java_home</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home</span><br><span class="line">bianxh:Versions bianxh$ java -version</span><br><span class="line">java version &quot;1.8.0_121&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_121-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)</span><br></pre></td></tr></table></figure></p>
<p>配置~/.bash_profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PATH&#125;:/Users/bianxh/Library/Android/sdk//platform-tools</span><br><span class="line">export PATH=$&#123;PATH&#125;:/Users/bianxh/Library/Android/sdk//tools</span><br><span class="line">export PATH=$&#123;PATH&#125;:/usr/local/apache-tomcat-7.0.77/bin</span><br><span class="line">export JAMES_SRC_HOME=/usr/local/james-project/james-project</span><br><span class="line"># 设置 JDK 8</span><br><span class="line">export JAVA_8_HOME=$(/usr/libexec/java_home -v 1.8)</span><br><span class="line"># 设置 JDK 7</span><br><span class="line">export JAVA_7_HOME=$(/usr/libexec/java_home -v 1.7)</span><br><span class="line">export JAVA_HOME=$JAVA_7_HOME</span><br><span class="line">#alias命令动态切换JDK版本</span><br><span class="line">alias jdk7=&quot;export JAVA_HOME=$&quot;JAVA_7_HOME&quot;</span><br><span class="line">alias jdk8=&quot;export JAVA_HOME=$&quot;JAVA_8_HOME&quot;</span><br><span class="line">alias subl=&quot;&apos;/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl&apos;&quot;</span><br><span class="line">alias ll=&apos;ls -al&apos;</span><br></pre></td></tr></table></figure></p>
<p>使用命令生效配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bianxh:Versions bianxh$ source ~/.bash_profile</span><br></pre></td></tr></table></figure></p>
<p>现在查看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bianxh:Versions bianxh$ java -version</span><br><span class="line">java version &quot;1.7.0_80&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</span><br><span class="line">bianxh:Versions bianxh$ /usr/libexec/java_home -v 1.7</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home</span><br><span class="line">bianxh:Versions bianxh$ /usr/libexec/java_home -v 1.8</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home</span><br></pre></td></tr></table></figure></p>
<p>以后就可以通过命令自由切换了，效果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bianxh:libexec bianxh$ jdk8</span><br><span class="line">bianxh:libexec bianxh$ java -version</span><br><span class="line">java version &quot;1.8.0_121&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_121-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)</span><br><span class="line">bianxh:libexec bianxh$ jdk7</span><br><span class="line">bianxh:libexec bianxh$ java -version</span><br><span class="line">java version &quot;1.7.0_80&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</span><br></pre></td></tr></table></figure></p>
<p>当然，如果用eclipse，注意修改JAVA_HOME，在~/.bash_profile中修改。</p>
<h1 id="2017-09-16-mac-chrome-开发者工具-快捷键"><a href="#2017-09-16-mac-chrome-开发者工具-快捷键" class="headerlink" title="2017-09-16-mac-chrome-开发者工具-快捷键"></a>2017-09-16-mac-chrome-开发者工具-快捷键</h1><p>开发者工具：option＋command＋i<br>javascript控制台：option＋command＋j<br>或者按option＋command＋c也可以打开</p>
<h1 id="2017-09-16-Myeclipse普通java项目转maven项目"><a href="#2017-09-16-Myeclipse普通java项目转maven项目" class="headerlink" title="2017-09-16-Myeclipse普通java项目转maven项目"></a>2017-09-16-Myeclipse普通java项目转maven项目</h1><p>1、先解决在项目上右键单击，没有出现Configure菜单的问题，因为此菜单的下级有Convert to Maven Project<br>解决办法：<br>window–&gt;Preferences–&gt;General–&gt;Capabilities–&gt;My Eclipse Standard Tools–&gt;Advenced，勾选如下两项：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-ba9b3c9f90d01719.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>2、转maven项目，自己输入<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yiyixiaozhi-maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>maven配置<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3、以要使用websoket为例，添加依赖关系<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>yiyixiaozhi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yiyixiaozhi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yiyixiaozhi-maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>maven配置<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.websocket-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javaee-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>备注：自己也可以设定maven的配置文件,settings.xml</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-576681a37d2b6164.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>建立一个C:\Users\zqzx.m2\settings.xml，源码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>~/.m2/repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span><span class="comment">&lt;!--需要改成自己的maven的本地仓库地址--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">repository</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>local private nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.oschina.net/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">          </span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>local private nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.oschina.net/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>下载成功了，如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-830ed6a10c3d4ce8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="2017-09-16-Mysql获取表中某个Datetime字段那天24点之前的数据"><a href="#2017-09-16-Mysql获取表中某个Datetime字段那天24点之前的数据" class="headerlink" title="2017-09-16-Mysql获取表中某个Datetime字段那天24点之前的数据"></a>2017-09-16-Mysql获取表中某个Datetime字段那天24点之前的数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_class_info where date_format(now(),&apos;%Y-%m-%d-%H-%i-%S&apos;)&gt;=begin_date and date_format(now(),&apos;%Y-%m-%d-%H-%i-%S&apos;)&lt;=date_format(end_date,&apos;%Y-%m-%d-24-00-00&apos;)</span><br></pre></td></tr></table></figure>
<p>关键是这句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date_format(now(),&apos;%Y-%m-%d-%H-%i-%S&apos;)&lt;=date_format(end_date,&apos;%Y-%m-%d-24-00-00&apos;)</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-Mysql-更新枚举enum类型"><a href="#2017-09-16-Mysql-更新枚举enum类型" class="headerlink" title="2017-09-16-Mysql-更新枚举enum类型"></a>2017-09-16-Mysql-更新枚举enum类型</h1><p>表定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t_seat` (                                                                    </span><br><span class="line">          `id` bigint(20) NOT NULL,                                                                </span><br><span class="line">         ...                                </span><br><span class="line">          `type` enum(&apos;seat&apos;,&apos;passage&apos;) DEFAULT NULL COMMENT &apos;座位类型（座位、过道）&apos;,  </span><br><span class="line">         ...                                                </span><br><span class="line">          PRIMARY KEY (`id`),                                                                      </span><br><span class="line">          KEY `place_id` (`place_id`)                                                              </span><br><span class="line">        ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;座位表&apos;</span><br></pre></td></tr></table></figure></p>
<p>如果要更新type，使用如下语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_seat a set a.type = &apos;seat&apos; where a.type = &apos;&apos;</span><br></pre></td></tr></table></figure></p>
<p>不能这么使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_seat a set a.type = &apos;seat&apos; where a.type is null</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-Mysql-获取某个时间之后一段时间的方法"><a href="#2017-09-16-Mysql-获取某个时间之后一段时间的方法" class="headerlink" title="2017-09-16-Mysql-获取某个时间之后一段时间的方法"></a>2017-09-16-Mysql-获取某个时间之后一段时间的方法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_class_info where place_id = 10 and date_format(now(),&apos;%Y-%m-%d-%H-%i-%S&apos;)&gt;=begin_date and date_format(now(),&apos;%Y-%m-%d-%H-%i-%S&apos;)&lt;=date_add(end_date, interval &apos;1 00:00:00&apos; day_second)</span><br></pre></td></tr></table></figure>
<p>参考：<a href="http://www.cnblogs.com/ggjucheng/p/3352280.html" target="_blank" rel="noopener">MySQL：日期函数、时间函数总结 - ggjucheng - 博客园</a></p>
<h1 id="2017-09-16-web开发入门之中文乱码"><a href="#2017-09-16-web开发入门之中文乱码" class="headerlink" title="2017-09-16-web开发入门之中文乱码"></a>2017-09-16-web开发入门之中文乱码</h1><p>假如jsp页面使用了utf-8编码。但是声明如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"ISO-8859-1"</span>%&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>实际运行过程就会中文乱码问题，改成如下就好了：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-Windows查看端口占用"><a href="#2017-09-16-Windows查看端口占用" class="headerlink" title="2017-09-16-Windows查看端口占用"></a>2017-09-16-Windows查看端口占用</h1><p>解决root账号无法登陆的问题：<br>修改my-default.ini，重命名为my.ini，修改文件内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># basedir = C:\Program Files\MySQL\MySQL Server 5.7</span><br><span class="line"># datadir = C:\Program Files\MySQL\MySQL Server 5.7\data</span><br></pre></td></tr></table></figure></p>
<p>在“C:\Program Files\MySQL\MySQL Server 5.7”下创建data文件夹<br>管理员运行cmd，输入：mysqld -install，显示安装成功；再输入：net start mysql<br>输入：mysqld –initialize –user=mysql –console 得到临时密码<br>启动服务net start mysql；<br>进入mysql命令下：mysql -u root -p，输入刚刚的密码；<br>更新root密码：mysql&gt; set password for root@localhost = password(‘123’); </p>
<p>解决无法在局域网通过sqlyog客户端链接mysql server的问题：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;use mysql;</span><br><span class="line">mysql&gt;update user set host = &apos;%&apos; where user = &apos;root&apos;;</span><br></pre></td></tr></table></figure></p>
<p>重启mysql服务后生效。</p>
<h1 id="2017-9-13-Ubuntu环境初始化安装Mysql并配置外网访问"><a href="#2017-9-13-Ubuntu环境初始化安装Mysql并配置外网访问" class="headerlink" title="2017-9-13-Ubuntu环境初始化安装Mysql并配置外网访问"></a>2017-9-13-Ubuntu环境初始化安装Mysql并配置外网访问</h1><p>1、安装：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure></p>
<p>2.检查是否安装成功：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tap | grep mysql</span><br></pre></td></tr></table></figure></p>
<p>3.允许远程连接：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure></p>
<p>把 bind-address这一行 注释掉，或者改为：<br>bind-address = 0.0.0.0</p>
<p>4.重启 MySQL：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netstat -tap | grep mysql</span><br><span class="line">tcp        0      0 localhost:mysql         *:*                     LISTEN      23381/mysqld    </span><br><span class="line">root@jdu4e00u53f7:/<span class="comment"># service mysql restart</span></span><br><span class="line">mysql stop/waiting</span><br><span class="line">mysql start/running, process 25300</span><br></pre></td></tr></table></figure></p>
<p>5.授权用户能进行远程连接：<br>首先进入mysql命令行<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; grant all privileges on *.* to root@<span class="string">"%"</span> identified by <span class="string">"password"</span> with grant option;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; <span class="built_in">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure></p>
<p>输入root安装mysql时，password使用安装时候设置的root用户密码。<br>然后执行：</p>
<p>最后用SQLyog测试一下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-3100b4c6495bda24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-72431949b4dbea59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>假如要授权某个用户访问，方法如下：<br>修改 Mysql-Server 用户配置<br>mysql&gt; USE mysql; – 切换到 mysql DB<br>  Database changed<br>  mysql&gt; SELECT User, Password, Host FROM user; – 查看现有用户,密码及允许连接的主机<br>  +——+———-+———–+<br>  | User | Password | Host      |<br>  +——+———-+———–+<br>  | root |          | localhost |<br>  +——+———-+———–+<br>  1 row in set (0.00 sec)<br>    mysql&gt; – 只有一个默认的 root 用户, 密码为空, 只允许 localhost 连接<br>  mysql&gt; – 下面我们另外添加一个新的 root 用户, 密码为空, 只允许 192.168.1.100 连接<br>  mysql&gt; GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@’192.168.1.100’ IDENTIFIED BY ‘’ WITH GRANT OPTION;<br>或允许所有ip访问：        mysql&gt; GRANT ALL PRIVILEGES ON  <em>.</em>  TO root@”%” IDENTIFIED BY ‘’;<br>  mysql&gt; – 当然我们也可以直接用 UPDATE 更新 root 用户 Host, 但不推荐, SQL如下:<br>  mysql&gt; – UPDATE user SET Host=’192.168.1.100’ WHERE User=’root’ AND Host=’localhost’ LIMIT 1;</p>
<h1 id="2017-9-19-Mysql-group-by报错"><a href="#2017-9-19-Mysql-group-by报错" class="headerlink" title="2017-9-19-Mysql group by报错"></a>2017-9-19-Mysql group by报错</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expression #1 of ORDER BY clause is not in GROUP BY clause and contains nonaggregated column &apos;information_schema.PROFILING.SEQ&apos; which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</span><br></pre></td></tr></table></figure>
<p>解决办法，去掉ONLY_FULL_GROUP_BY，重新设置值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@global.sql_mode</span><br><span class="line"><span class="keyword">set</span> @@global.sql_mode =<span class="string">'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br></pre></td></tr></table></figure>
<h1 id="2017-09-16-微信公众号消息自动回复中文乱码问题"><a href="#2017-09-16-微信公众号消息自动回复中文乱码问题" class="headerlink" title="2017-09-16-微信公众号消息自动回复中文乱码问题"></a>2017-09-16-微信公众号消息自动回复中文乱码问题</h1><p>设置servlet请求和响应为utf-8，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HttpServletRequest request = <span class="keyword">this</span>.getRequest();</span><br><span class="line">HttpServletResponse response = <span class="keyword">this</span>.getResponse();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">	response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e1) &#123;</span><br><span class="line">	<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">	e1.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-小结：使用正则表达式提取时间中的数字"><a href="#2017-09-16-小结：使用正则表达式提取时间中的数字" class="headerlink" title="2017-09-16-小结：使用正则表达式提取时间中的数字"></a>2017-09-16-小结：使用正则表达式提取时间中的数字</h1><p>Quartz任务中对于时间的设定，有一定的规则，比如：<br>“05 39 21 27 8 ? 2017”<br>从数据库取出来的时间格式不是这样的，是这样的：<br>2017-08-17 10:55:00<br>所以我们要提取其中的数字，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分割符是 "-" 或 空格" " 或冒号 ":"</span></span><br><span class="line">String time = <span class="string">"2017-08-17 10:55:00"</span>;</span><br><span class="line">String[] times = time.split(<span class="string">"[\\-:\\s]&#123;1,&#125;"</span>);</span><br></pre></td></tr></table></figure></p>
<p>结果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-3074d60d642036a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>对了，还需要反转，才能对上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; timesList = Arrays.asList(times);</span><br><span class="line">Collections.reverse(timesList);</span><br><span class="line">times = (String[]) timesList.toArray();</span><br></pre></td></tr></table></figure></p>
<p>如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-fb5a6365be6afce0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>什么？还缺一个问号？<br>由于Arrays.asList(times);返回的是一个固定长度的List，这次要折腾一下了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String time = <span class="string">"2017-08-17 10:55:00"</span>;</span><br><span class="line"><span class="comment">// 分割符是 "-" 或 空格" " 或冒号 ":"</span></span><br><span class="line">String[] times = time.split(<span class="string">"[\\-:\\s]&#123;1,&#125;"</span>);</span><br><span class="line">List&lt;String&gt; timesList = Arrays.asList(times);</span><br><span class="line">List&lt;String&gt; flexibleTimesList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">flexibleTimesList.addAll(timesList);</span><br><span class="line">flexibleTimesList.add(<span class="number">1</span>,<span class="string">"?"</span>);</span><br><span class="line">Collections.reverse(flexibleTimesList);</span><br><span class="line">String[] resultTimes = <span class="keyword">new</span> String[flexibleTimesList.size()];</span><br><span class="line"><span class="keyword">for</span> (String str : flexibleTimesList) &#123;</span><br><span class="line">	System.out.println(str);</span><br><span class="line">&#125;</span><br><span class="line">resultTimes =  (String[]) flexibleTimesList.toArray();</span><br></pre></td></tr></table></figure></p>
<p>打印都出来了，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">00</span><br><span class="line">55</span><br><span class="line">10</span><br><span class="line">17</span><br><span class="line">08</span><br><span class="line">?</span><br><span class="line">2017</span><br></pre></td></tr></table></figure></p>
<p>但是走到最后一句，结果报错：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [Ljava.lang.String;</span><br><span class="line">	at com.test.hello.Main.main(Main.java:38)</span><br></pre></td></tr></table></figure></p>
<p>为什么呢？<br>因为toArray()返回的是Object[] java.util.List.toArray()，强转String[]有问题。改用如下的办法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flexibleTimesList.toArray(resultTimes);</span><br></pre></td></tr></table></figure></p>
<p>OK了，看看结果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-8bebde5b06e8b7c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>最后，别忘了转换，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"><span class="keyword">for</span>(String str : resultTimes) &#123;</span><br><span class="line">	sb.append(str + <span class="string">" "</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 干掉最后一个空格</span></span><br><span class="line">time = sb.toString().substring(<span class="number">0</span>, sb.length() - <span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">"&#123;"</span> + time + <span class="string">"&#125;"</span>);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注：StringBuffer 比StringBuilder线程安全，比String +执行效率高，用这个连接字符串最合适。</p>
</blockquote>
<p>打印结果如下，多余的空格也剔除了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;00 55 10 17 08 ? 2017&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-定时获取微信的AccessToken"><a href="#2017-09-16-定时获取微信的AccessToken" class="headerlink" title="2017-09-16-定时获取微信的AccessToken"></a>2017-09-16-定时获取微信的AccessToken</h1><p>使用Quartz 2.2.3开启定时任务，每个整点获取一次，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String jobName = <span class="string">"GetWeixinAccessToken"</span>;</span><br><span class="line">String triggerName = jobName;</span><br><span class="line"><span class="comment">// 每个整点执行一次</span></span><br><span class="line">quartzManager.addJob(jobName, triggerName, WeixinAccessTokenJob.class, <span class="string">"0 0 */1 * * ?"</span>, wxAccesstokenManager);</span><br></pre></td></tr></table></figure></p>
<p>QuartzManager使用Spring注入：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.quartz.CronScheduleBuilder;</span><br><span class="line"><span class="keyword">import</span> org.quartz.CronTrigger;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobBuilder;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobDetail;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobKey;</span><br><span class="line"><span class="keyword">import</span> org.quartz.Scheduler;</span><br><span class="line"><span class="keyword">import</span> org.quartz.SchedulerException;</span><br><span class="line"><span class="keyword">import</span> org.quartz.SchedulerFactory;</span><br><span class="line"><span class="keyword">import</span> org.quartz.Trigger;</span><br><span class="line"><span class="keyword">import</span> org.quartz.TriggerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.quartz.TriggerKey;</span><br><span class="line"><span class="keyword">import</span> org.quartz.impl.StdSchedulerFactory;</span><br><span class="line"><span class="keyword">import</span> org.quartz.impl.matchers.GroupMatcher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzManager</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> SchedulerFactory schedulerFactory = <span class="keyword">new</span> StdSchedulerFactory();  </span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addJob</span><span class="params">(String jobName, String triggerName,</span></span></span><br><span class="line"><span class="function"><span class="params">			Class jobClass, String cron, Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Scheduler sched = schedulerFactory.getScheduler();</span><br><span class="line">			<span class="comment">// 任务名，任务组，任务执行类</span></span><br><span class="line">			JobDetail jobDetail = JobBuilder.newJob(jobClass)</span><br><span class="line">					.withIdentity(jobName).build();</span><br><span class="line">			jobDetail.getJobDataMap().put(<span class="string">"obj"</span>, obj);</span><br><span class="line">			<span class="comment">// 触发器</span></span><br><span class="line">			TriggerBuilder&lt;Trigger&gt; triggerBuilder = TriggerBuilder</span><br><span class="line">					.newTrigger();</span><br><span class="line">			<span class="comment">// 触发器名</span></span><br><span class="line">			triggerBuilder.withIdentity(triggerName);</span><br><span class="line">			triggerBuilder.startNow();</span><br><span class="line">			<span class="comment">// 触发器时间设定</span></span><br><span class="line">			triggerBuilder.withSchedule(CronScheduleBuilder.cronSchedule(cron));</span><br><span class="line">			<span class="comment">// 创建Trigger对象</span></span><br><span class="line">			CronTrigger trigger = (CronTrigger) triggerBuilder.build();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 调度容器设置JobDetail和Trigger</span></span><br><span class="line">			sched.scheduleJob(jobDetail, trigger);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 启动</span></span><br><span class="line">			<span class="keyword">if</span> (!sched.isShutdown()) &#123;</span><br><span class="line">				sched.start();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	    <span class="comment">/** </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@Description</span>: 添加一个定时任务 </span></span><br><span class="line"><span class="comment">	     *  </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobName 任务名 </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobGroupName  任务组名 </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> triggerName 触发器名 </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> triggerGroupName 触发器组名 </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobClass  任务 </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> cron   时间设置，参考quartz说明文档  </span></span><br><span class="line"><span class="comment">	     */</span>  </span><br><span class="line">	    <span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span> &#125;)  </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addJob</span><span class="params">(String jobName, String jobGroupName, </span></span></span><br><span class="line"><span class="function"><span class="params">	            String triggerName, String triggerGroupName, Class jobClass, String cron)</span> </span>&#123;  </span><br><span class="line">	        <span class="keyword">try</span> &#123;  </span><br><span class="line">	            Scheduler sched = schedulerFactory.getScheduler();  </span><br><span class="line">	            <span class="comment">// 任务名，任务组，任务执行类</span></span><br><span class="line">	            JobDetail jobDetail= JobBuilder.newJob(jobClass).withIdentity(jobName, jobGroupName).build();</span><br><span class="line"></span><br><span class="line">	            <span class="comment">// 触发器  </span></span><br><span class="line">	            TriggerBuilder&lt;Trigger&gt; triggerBuilder = TriggerBuilder.newTrigger();</span><br><span class="line">	            <span class="comment">// 触发器名,触发器组  </span></span><br><span class="line">	            triggerBuilder.withIdentity(triggerName, triggerGroupName);</span><br><span class="line">	            triggerBuilder.startNow();</span><br><span class="line">	            <span class="comment">// 触发器时间设定  </span></span><br><span class="line">	            triggerBuilder.withSchedule(CronScheduleBuilder.cronSchedule(cron));</span><br><span class="line">	            <span class="comment">// 创建Trigger对象</span></span><br><span class="line">	            CronTrigger trigger = (CronTrigger) triggerBuilder.build();</span><br><span class="line"></span><br><span class="line">	            <span class="comment">// 调度容器设置JobDetail和Trigger</span></span><br><span class="line">	            sched.scheduleJob(jobDetail, trigger);  </span><br><span class="line"></span><br><span class="line">	            <span class="comment">// 启动  </span></span><br><span class="line">	            <span class="keyword">if</span> (!sched.isShutdown()) &#123;  </span><br><span class="line">	                sched.start();  </span><br><span class="line">	            &#125;  </span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">	            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);  </span><br><span class="line">	        &#125;  </span><br><span class="line">	    &#125;  </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 修改任务的触发时间</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> triggerName</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cron</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">modifyJobTime</span><span class="params">(String jobName, String triggerName,</span></span></span><br><span class="line"><span class="function"><span class="params">			String cron)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Scheduler sched = schedulerFactory.getScheduler();</span><br><span class="line">			TriggerKey triggerKey = TriggerKey.triggerKey(triggerName);</span><br><span class="line">			CronTrigger trigger = (CronTrigger) sched.getTrigger(triggerKey);</span><br><span class="line">			<span class="keyword">if</span> (trigger == <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			String oldTime = trigger.getCronExpression();</span><br><span class="line">			<span class="keyword">if</span> (!oldTime.equalsIgnoreCase(cron)) &#123;</span><br><span class="line">				<span class="comment">/** 方式一 ：调用 rescheduleJob 开始 */</span></span><br><span class="line">				<span class="comment">// 触发器</span></span><br><span class="line">				TriggerBuilder&lt;Trigger&gt; triggerBuilder = TriggerBuilder</span><br><span class="line">						.newTrigger();</span><br><span class="line">				<span class="comment">// 触发器名,触发器组</span></span><br><span class="line">				triggerBuilder.withIdentity(triggerName);</span><br><span class="line">				triggerBuilder.startNow();</span><br><span class="line">				<span class="comment">// 触发器时间设定</span></span><br><span class="line">				triggerBuilder.withSchedule(CronScheduleBuilder</span><br><span class="line">						.cronSchedule(cron));</span><br><span class="line">				<span class="comment">// 创建Trigger对象</span></span><br><span class="line">				trigger = (CronTrigger) triggerBuilder.build();</span><br><span class="line">				<span class="comment">// 方式一 ：修改一个任务的触发时间</span></span><br><span class="line">				sched.rescheduleJob(triggerKey, trigger);</span><br><span class="line">				<span class="comment">/** 方式一 ：调用 rescheduleJob 结束 */</span></span><br><span class="line"></span><br><span class="line">				<span class="comment">/** 方式二：先删除，然后在创建一个新的Job */</span></span><br><span class="line">				<span class="comment">// JobDetail jobDetail =</span></span><br><span class="line">				<span class="comment">// sched.getJobDetail(JobKey.jobKey(jobName, jobGroupName));</span></span><br><span class="line">				<span class="comment">// Class&lt;? extends Job&gt; jobClass = jobDetail.getJobClass();</span></span><br><span class="line">				<span class="comment">// removeJob(jobName, jobGroupName, triggerName,</span></span><br><span class="line">				<span class="comment">// triggerGroupName);</span></span><br><span class="line">				<span class="comment">// addJob(jobName, jobGroupName, triggerName, triggerGroupName,</span></span><br><span class="line">				<span class="comment">// jobClass, cron);</span></span><br><span class="line">				<span class="comment">/** 方式二 ：先删除，然后在创建一个新的Job */</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	    <span class="comment">/** </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@Description</span>: 修改一个任务的触发时间</span></span><br><span class="line"><span class="comment">	     *  </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobName </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobGroupName</span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> triggerName 触发器名</span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> triggerGroupName 触发器组名 </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> cron   时间设置，参考quartz说明文档   </span></span><br><span class="line"><span class="comment">	     */</span>  </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">modifyJobTime</span><span class="params">(String jobName, </span></span></span><br><span class="line"><span class="function"><span class="params">	            String jobGroupName, String triggerName, String triggerGroupName, String cron)</span> </span>&#123;  </span><br><span class="line">	        <span class="keyword">try</span> &#123;  </span><br><span class="line">	            Scheduler sched = schedulerFactory.getScheduler();  </span><br><span class="line">	            TriggerKey triggerKey = TriggerKey.triggerKey(triggerName, triggerGroupName);</span><br><span class="line">	            CronTrigger trigger = (CronTrigger) sched.getTrigger(triggerKey);  </span><br><span class="line">	            <span class="keyword">if</span> (trigger == <span class="keyword">null</span>) &#123;  </span><br><span class="line">	                <span class="keyword">return</span>;  </span><br><span class="line">	            &#125;  </span><br><span class="line"></span><br><span class="line">	            String oldTime = trigger.getCronExpression();  </span><br><span class="line">	            <span class="keyword">if</span> (!oldTime.equalsIgnoreCase(cron)) &#123; </span><br><span class="line">	                <span class="comment">/** 方式一 ：调用 rescheduleJob 开始 */</span></span><br><span class="line">	                <span class="comment">// 触发器  </span></span><br><span class="line">	                TriggerBuilder&lt;Trigger&gt; triggerBuilder = TriggerBuilder.newTrigger();</span><br><span class="line">	                <span class="comment">// 触发器名,触发器组  </span></span><br><span class="line">	                triggerBuilder.withIdentity(triggerName, triggerGroupName);</span><br><span class="line">	                triggerBuilder.startNow();</span><br><span class="line">	                <span class="comment">// 触发器时间设定  </span></span><br><span class="line">	                triggerBuilder.withSchedule(CronScheduleBuilder.cronSchedule(cron));</span><br><span class="line">	                <span class="comment">// 创建Trigger对象</span></span><br><span class="line">	                trigger = (CronTrigger) triggerBuilder.build();</span><br><span class="line">	                <span class="comment">// 方式一 ：修改一个任务的触发时间</span></span><br><span class="line">	                sched.rescheduleJob(triggerKey, trigger);</span><br><span class="line">	                <span class="comment">/** 方式一 ：调用 rescheduleJob 结束 */</span></span><br><span class="line"></span><br><span class="line">	                <span class="comment">/** 方式二：先删除，然后在创建一个新的Job  */</span></span><br><span class="line">	                <span class="comment">//JobDetail jobDetail = sched.getJobDetail(JobKey.jobKey(jobName, jobGroupName));  </span></span><br><span class="line">	                <span class="comment">//Class&lt;? extends Job&gt; jobClass = jobDetail.getJobClass();  </span></span><br><span class="line">	                <span class="comment">//removeJob(jobName, jobGroupName, triggerName, triggerGroupName);  </span></span><br><span class="line">	                <span class="comment">//addJob(jobName, jobGroupName, triggerName, triggerGroupName, jobClass, cron); </span></span><br><span class="line">	                <span class="comment">/** 方式二 ：先删除，然后在创建一个新的Job */</span></span><br><span class="line">	            &#125;  </span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">	            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);  </span><br><span class="line">	        &#125;  </span><br><span class="line">	    &#125;  </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@Description</span>: 移除一个任务</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> triggerName</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeJob</span><span class="params">(String jobName, String triggerName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Scheduler sched = schedulerFactory.getScheduler();</span><br><span class="line">			TriggerKey triggerKey = TriggerKey.triggerKey(triggerName);</span><br><span class="line">			sched.pauseTrigger(triggerKey);<span class="comment">// 停止触发器</span></span><br><span class="line">			sched.unscheduleJob(triggerKey);<span class="comment">// 移除触发器</span></span><br><span class="line">			sched.deleteJob(JobKey.jobKey(jobName));<span class="comment">// 删除任务</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="comment">/** </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@Description</span>: 移除一个任务 </span></span><br><span class="line"><span class="comment">	     *  </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobName </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobGroupName </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> triggerName </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> triggerGroupName </span></span><br><span class="line"><span class="comment">	     */</span>  </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeJob</span><span class="params">(String jobName, String jobGroupName,  </span></span></span><br><span class="line"><span class="function"><span class="params">	            String triggerName, String triggerGroupName)</span> </span>&#123;  </span><br><span class="line">	        <span class="keyword">try</span> &#123;  </span><br><span class="line">	            Scheduler sched = schedulerFactory.getScheduler();  </span><br><span class="line"></span><br><span class="line">	            TriggerKey triggerKey = TriggerKey.triggerKey(triggerName, triggerGroupName);</span><br><span class="line"></span><br><span class="line">	            sched.pauseTrigger(triggerKey);<span class="comment">// 停止触发器  </span></span><br><span class="line">	            sched.unscheduleJob(triggerKey);<span class="comment">// 移除触发器  </span></span><br><span class="line">	            sched.deleteJob(JobKey.jobKey(jobName, jobGroupName));<span class="comment">// 删除任务  </span></span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">	            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);  </span><br><span class="line">	        &#125;  </span><br><span class="line">	    &#125;  </span><br><span class="line"></span><br><span class="line">	    <span class="comment">/** </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@Description</span>:启动所有定时任务 </span></span><br><span class="line"><span class="comment">	     */</span>  </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startJobs</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">	        <span class="keyword">try</span> &#123;  </span><br><span class="line">	            Scheduler sched = schedulerFactory.getScheduler();  </span><br><span class="line">	            sched.start();  </span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">	            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);  </span><br><span class="line">	        &#125;  </span><br><span class="line">	    &#125;  </span><br><span class="line"></span><br><span class="line">	    <span class="comment">/** </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@Description</span>:关闭所有定时任务 </span></span><br><span class="line"><span class="comment">	     */</span>  </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shutdownJobs</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">	        <span class="keyword">try</span> &#123;  </span><br><span class="line">	            Scheduler sched = schedulerFactory.getScheduler();  </span><br><span class="line">	            <span class="keyword">if</span> (!sched.isShutdown()) &#123;  </span><br><span class="line">	                sched.shutdown();  </span><br><span class="line">	            &#125;  </span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">	            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);  </span><br><span class="line">	        &#125;  </span><br><span class="line">	    &#125;</span><br><span class="line">	    </span><br><span class="line">	    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	     * 判断JobName是否在执行队列中</span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	     */</span></span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isJobExist</span><span class="params">(String jobName)</span> <span class="keyword">throws</span> SchedulerException </span>&#123;</span><br><span class="line">	    	<span class="keyword">boolean</span> isExistJob = <span class="keyword">false</span>;</span><br><span class="line">	    	Scheduler scheduler = schedulerFactory.getScheduler();</span><br><span class="line">	    	<span class="keyword">for</span> (String groupName : scheduler.getJobGroupNames()) &#123;</span><br><span class="line">	    		<span class="keyword">for</span> (JobKey jobKey : scheduler.getJobKeys(GroupMatcher</span><br><span class="line">	    				.jobGroupEquals(groupName))) &#123;</span><br><span class="line">	    			String tmpJobName = jobKey.getName();</span><br><span class="line">	    			String jobGroup = jobKey.getGroup();</span><br><span class="line">	    			<span class="comment">// get job's trigger</span></span><br><span class="line">	    			<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">	    			List&lt;Trigger&gt; triggers = (List&lt;Trigger&gt;) scheduler</span><br><span class="line">	    			.getTriggersOfJob(jobKey);</span><br><span class="line">	    			Date nextFireTime = triggers.get(<span class="number">0</span>).getNextFireTime();</span><br><span class="line">	    			System.out.println(<span class="string">"[jobName] : "</span> + tmpJobName</span><br><span class="line">	    					+ <span class="string">" [groupName] : "</span> + jobGroup + <span class="string">" - "</span></span><br><span class="line">	    					+ nextFireTime);</span><br><span class="line">	    			<span class="keyword">if</span> (tmpJobName.equals(jobName)) &#123;</span><br><span class="line">	    				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	    			&#125;</span><br><span class="line">	    		&#125;</span><br><span class="line">	    	&#125;</span><br><span class="line">			<span class="keyword">return</span> isExistJob;</span><br><span class="line">	    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在Spring ApplicationContext注入后，才可获取bean，web.xml配置拦截如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring ApplicationContext 载入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.test.hello.ContextLoaderListenerOverWrite<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>拦截类是为了获取manager，然后存放AccessToken到数据库中。实现如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextLoaderListenerOverWrite</span> <span class="keyword">extends</span> <span class="title">ContextLoaderListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">super</span>.contextInitialized(event);</span><br><span class="line">		ApplicationContext applicationContext = WebApplicationContextUtils.getWebApplicationContext(event.getServletContext());  </span><br><span class="line">      		startGetWeixinAccessTokenJobs(applicationContext);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 开启整点定时任务</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startGetWeixinAccessTokenJobs</span><span class="params">(ApplicationContext ctx)</span> </span>&#123;</span><br><span class="line">		WxBean currentBean = Utility.getAccessToken();</span><br><span class="line">		WxAccesstoken currentToken = <span class="keyword">new</span> WxAccesstoken();</span><br><span class="line">		currentToken.setAccesstoken(currentBean.getAccess_token());</span><br><span class="line">		currentToken.setExpiresIn(Integer.valueOf(currentBean.getExpires_in()));</span><br><span class="line">		currentToken.setLastRequestTime(<span class="keyword">new</span> Date());</span><br><span class="line">		</span><br><span class="line">		QuartzManager quartzManager = (QuartzManager)ctx.getBean(<span class="string">"quartzManager"</span>);</span><br><span class="line">		WxAccesstokenManager wxAccesstokenManager = (WxAccesstokenManager)ctx.getBean(<span class="string">"wxAccesstokenManager"</span>);</span><br><span class="line">		WxAccesstoken dbWxToken = wxAccesstokenManager.findFirst();</span><br><span class="line">		<span class="keyword">if</span> (dbWxToken == <span class="keyword">null</span>) &#123;	<span class="comment">// 新增Token</span></span><br><span class="line">			wxAccesstokenManager.save(currentToken);</span><br><span class="line">			System.out.println(<span class="string">"新增Token："</span> + currentToken);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;	<span class="comment">// 更新Token</span></span><br><span class="line">			currentToken.setId(dbWxToken.getId());</span><br><span class="line">			wxAccesstokenManager.update(currentToken);</span><br><span class="line">			System.out.println(<span class="string">"更新Token："</span> + currentToken);</span><br><span class="line">		&#125;</span><br><span class="line">		String jobName = <span class="string">"GetWeixinAccessToken"</span>;</span><br><span class="line">		String triggerName = jobName;</span><br><span class="line">		<span class="comment">// 每个整点执行一次</span></span><br><span class="line">		quartzManager.addJob(jobName, triggerName, WeixinAccessTokenJob.class, <span class="string">"0 0 */1 * * ?"</span>, wxAccesstokenManager);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>获取微信AccessToken的办法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取微信的AccessToken</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> WxBean <span class="title">getAccessToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	WxBean bean = <span class="keyword">null</span>;</span><br><span class="line">	Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">	params.put(<span class="string">"grant_type"</span>, <span class="string">"client_credential"</span>);</span><br><span class="line">	params.put(<span class="string">"appid"</span>, Constants.WEIXIN_APPID);</span><br><span class="line">	params.put(<span class="string">"secret"</span>, Constants.WEIXIN_APPSECRET);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		String jstoken = HttpUtils.sendGet(</span><br><span class="line">				<span class="string">"https://api.weixin.qq.com/cgi-bin/token"</span>, params);</span><br><span class="line">		<span class="comment">// String access_token = JSONObject.fromObject(jstoken).getString(</span></span><br><span class="line">		<span class="comment">// "access_token"); // 获取到token并赋值保存</span></span><br><span class="line">		ObjectMapper objectMapper = JsonUtils.createObjectMapper();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			bean = objectMapper.readValue(jstoken, WxBean.class);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JsonParseException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JsonMappingException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对了，还有关键的部分，在这个Job里面每个整点更新AccessToken<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeixinAccessTokenJob</span> <span class="keyword">implements</span> <span class="title">Job</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WeixinAccessTokenJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">		<span class="comment">//打印任务详情  </span></span><br><span class="line">        System.out.println( <span class="string">"WeixinTokenJob:"</span> + <span class="string">"-"</span> +</span><br><span class="line">                context.getJobDetail().getKey().getGroup() </span><br><span class="line">                +<span class="string">"——"</span>+context.getJobDetail().getKey().getName()  </span><br><span class="line">                +<span class="string">"——"</span>+context.getTrigger().getKey().getName()  </span><br><span class="line">                +<span class="string">"——"</span>+context.getTrigger().getKey().getGroup() + <span class="keyword">new</span> Date());</span><br><span class="line">                JobDataMap jobDataMap = context.getJobDetail().getJobDataMap();</span><br><span class="line">                WxAccesstokenManager wxAccesstokenManager = (WxAccesstokenManager)jobDataMap.get(<span class="string">"obj"</span>);</span><br><span class="line">		<span class="comment">// Todo 使用wxAccesstokenManager来管理数据库存放的AccessToken</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="2017-09-16-使用JFinal添加数据报id异常"><a href="#2017-09-16-使用JFinal添加数据报id异常" class="headerlink" title="2017-09-16-使用JFinal添加数据报id异常"></a>2017-09-16-使用JFinal添加数据报id异常</h1><p>使用Jfinal新增一条数据：</p>
<p>new CommentRecord().set(“comment_time”, new SimpleDateFormat(“yyyy-MM-dd HH:mm:ss”).format(new Date())).set(“star_level”, starLevel).set(“comment”, commentText).save();</p>
<p>结果报错如下：</p>
<p>com.jfinal.plugin.activerecord.ActiveRecordException: java.sql.SQLException: Field ‘id’ doesn’t have a default value    at com.jfinal.plugin.activerecord.Model.save(Model.java:424)…Caused by: java.sql.SQLException: Field ‘id’ doesn’t have a default valueat com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1073)…</p>
<p>原因是数据库对应的Table表的主键id不是自增的，修改即可：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-8e6e0392561d5230.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h1 id="2017-09-16-使用jstl优化评论星标html代码"><a href="#2017-09-16-使用jstl优化评论星标html代码" class="headerlink" title="2017-09-16-使用jstl优化评论星标html代码"></a>2017-09-16-使用jstl优化评论星标html代码</h1><p>评论需要加5颗星的功能，之前代码是这么写的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">c:if</span></span></span><br><span class="line"><span class="tag">	<span class="attr">test</span>=<span class="string">"$&#123;star_level == 1&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span> <span class="tag">&lt;<span class="name">c:if</span></span></span><br><span class="line"><span class="tag">	<span class="attr">test</span>=<span class="string">"$&#123;star_level == 2&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span> <span class="tag">&lt;<span class="name">c:if</span></span></span><br><span class="line"><span class="tag">	<span class="attr">test</span>=<span class="string">"$&#123;star_level == 3&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span> <span class="tag">&lt;<span class="name">c:if</span></span></span><br><span class="line"><span class="tag">	<span class="attr">test</span>=<span class="string">"$&#123;star_level == 4&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span> <span class="tag">&lt;<span class="name">c:if</span></span></span><br><span class="line"><span class="tag">	<span class="attr">test</span>=<span class="string">"$&#123;star_level == 5&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;curentCommentRecord == null || star_level == 0&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>是不是看着很冗余？如果是10颗星呢？那代码就更长了，也不好维护，看着不舒服，那咋优化呢？<br>如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">begin</span>=<span class="string">'1'</span> <span class="attr">end</span>=<span class="string">"5"</span> <span class="attr">var</span>=<span class="string">'item'</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">c:choose</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">c:when</span> <span class="attr">test</span>=<span class="string">"$&#123;item &lt;= star_level &#125;"</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"ys"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">c:when</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">c:choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果出来了，棒棒哒。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-43b9d20268c97ccf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="2017-09-16-关于Tomcat自动加载更新class的小技巧"><a href="#2017-09-16-关于Tomcat自动加载更新class的小技巧" class="headerlink" title="2017-09-16-关于Tomcat自动加载更新class的小技巧"></a>2017-09-16-关于Tomcat自动加载更新class的小技巧</h1><p>在Tomcat的server.xml或者Tomcat.xxx\conf\Catalina\localhost\project.xml文件中里Context标签内：<br><!-- reloadable为fase表示项目不自动布署 --> </p>
<p><context reloadable="false"><br><!-- reloadable为true表示项目自动布署 --> </context></p>
<context reloadable="true"> 

<p>第二步：debug方式启动Tomcat。如果你用的是eclipse Tomcat插件的话，<br>将Don’t run tomcat debug mode取消勾选，就是将会是debug方式启动Tomcat了：<br>window=&gt;preferences=&gt;Tomcat=&gt;JVM Settings<br><img src="http://upload-images.jianshu.io/upload_images/1124873-d511854807bc664b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>如果是MyEclipse:<img src="http://upload-images.jianshu.io/upload_images/1124873-46b93e3b9649a774.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h1 id="2017-09-16-内网穿透"><a href="#2017-09-16-内网穿透" class="headerlink" title="2017-09-16-内网穿透"></a>2017-09-16-内网穿透</h1><p>使用frp进行内网穿透，可以很方便地进行调试，比如微信公众号。穿透前，需要有一台能连接公网的机器，京东云最近做活动，可以免费半年。我在这上面进行了实战。</p>
<p>原来用的是花生壳，但是有很多限制，还是自己弄了域名比较方便。</p>
<p>frp是什么，就不多说了，有兴趣的童鞋看这个：<a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">https://github.com/fatedier/frp</a></p>
<p>工具在上面的github地址上可以下载到，我提供一个X86 CPU版本的windows和linux版本的地址。<br>链接：<a href="http://pan.baidu.com/s/1kV7R39t" target="_blank" rel="noopener">http://pan.baidu.com/s/1kV7R39t</a> 密码：md3a</p>
<p>在公网IP服务器配置frps.ini，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line">vhost_http_port = 80</span><br></pre></td></tr></table></figure></p>
<p>本地局域网配置frpc.ini<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 111.61.131.13</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 192.168.3.133</span><br><span class="line">local_port = 22</span><br><span class="line">remote_port = 6000</span><br><span class="line"></span><br><span class="line">[web]</span><br><span class="line">type = http</span><br><span class="line">local_port = 8080</span><br><span class="line">custom_domains = test.bianxh.top</span><br></pre></td></tr></table></figure></p>
<p>公网使用的是Linux，运行命令如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@***:~/frp_0.13.0_linux_386<span class="comment"># ./frps -c ./frps.ini</span></span><br><span class="line">2017/09/12 12:37:50 [I] [service.go:83] frps tcp listen on 0.0.0.0:7000</span><br><span class="line">2017/09/12 12:37:50 [I] [service.go:108] http service listen on 0.0.0.0:80</span><br><span class="line">2017/09/12 12:37:50 [I] [main.go:112] Start frps success</span><br><span class="line">2017/09/12 12:37:50 [I] [main.go:114] PrivilegeMode is enabled, you should pay more attention to security issues</span><br></pre></td></tr></table></figure></p>
<p>本地是Windows，运行命令如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\GreenSoft\frp_0.13.0_windows_amd64&gt;frpc.exe -c frpc.ini</span><br><span class="line">2017/09/12 12:35:00 [I] [control.go:276] [ded5c9fb0d273509] login to server success, get run id [ded5c9fb0d273509]</span><br><span class="line">2017/09/12 12:35:01 [I] [control.go:411] [ded5c9fb0d273509] [ssh] start proxy success</span><br><span class="line">2017/09/12 12:35:01 [I] [control.go:411] [ded5c9fb0d273509] [web] start proxy success</span><br></pre></td></tr></table></figure></p>
<p>下来去服务商管理后台，配置下域名解析：</p>
<table>
<thead>
<tr>
<th style="text-align:left">记录类型</th>
<th style="text-align:center">主机记录</th>
<th style="text-align:center">记录值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:center">test</td>
<td style="text-align:center">公网IP，比如：111.61.131.13</td>
</tr>
</tbody>
</table>
<p>可以访问到本地了：<br><a href="http://test.bianxh.top/yiyixiaozhi/webSocketTest.jsp" target="_blank" rel="noopener">http://test.bianxh.top/yiyixiaozhi/webSocketTest.jsp</a><br>和本地访问一样，如下：<br><img src="http://upload-images.jianshu.io/upload_images/1124873-5ac4c0e08aecf19c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>刚刷新两次，就提示无法访问了，没有备案的域名果然不好使啊：<br><a href="http://illegalitydomain.jcloud.com/" target="_blank" rel="noopener">http://illegalitydomain.jcloud.com/</a></p>
<p>换个地址，使用端口访问了一下，是通的。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1124873-7da5a6a072f86c27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>下来还是要乖乖备案去。<br><img src="http://upload-images.jianshu.io/upload_images/1124873-4cadb4a3589fbd93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
</context>
      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="无 wechat" style="width: 200px; max-width: 100%;">
    <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>欢迎打赏</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="无 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="无 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/17/2017/2017-09-17-我的天空/" rel="next" title="我的天空">
                <i class="fa fa-chevron-left"></i> 我的天空
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/19/2017/设计规范调研/" rel="prev" title="设计规范调研">
                设计规范调研 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">无</p>
              <p class="site-description motion-element" itemprop="description">一些文档</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/bxh7425014" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/yiyixiaozhi" target="_blank" title="知乎">
                    
                      <i class="fa fa-fw fa-blind"></i>知乎</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/u/1935290765" target="_blank" title="微博">
                    
                      <i class="fa fa-fw fa-weibo"></i>微博</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://dbanotes.net/" title="闲思录" target="_blank">闲思录</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-4-9-ubuntu服务器环境搭建"><span class="nav-number">1.</span> <span class="nav-text">2017-4-9 ubuntu服务器环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Linux环境属性"><span class="nav-number">1.1.</span> <span class="nav-text">配置Linux环境属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh连接配置"><span class="nav-number">1.2.</span> <span class="nav-text">ssh连接配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ftp服务"><span class="nav-number">1.3.</span> <span class="nav-text">ftp服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDK的安装与配置"><span class="nav-number">1.4.</span> <span class="nav-text">JDK的安装与配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在Linux中安装Hadoop"><span class="nav-number">1.5.</span> <span class="nav-text">在Linux中安装Hadoop</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-04-28-Mac开发环境搭建"><span class="nav-number">2.</span> <span class="nav-text">2017-04-28 Mac开发环境搭建</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mac-Web开发环境配置"><span class="nav-number">3.</span> <span class="nav-text">Mac Web开发环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装brew"><span class="nav-number">3.1.</span> <span class="nav-text">安装brew</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Redis"><span class="nav-number">3.2.</span> <span class="nav-text">安装Redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装zookeeper"><span class="nav-number">3.3.</span> <span class="nav-text">安装zookeeper</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装邮件服务-James-server"><span class="nav-number">3.4.</span> <span class="nav-text">安装邮件服务 James server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fix-problems"><span class="nav-number">3.5.</span> <span class="nav-text">Fix problems</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#maven报错："><span class="nav-number">3.5.1.</span> <span class="nav-text">maven报错：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mac下，dubbo注册zookeeper，ip地址是一个虚拟的地址，并不是局域网的本机ip"><span class="nav-number">3.5.2.</span> <span class="nav-text">mac下，dubbo注册zookeeper，ip地址是一个虚拟的地址，并不是局域网的本机ip</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-微信开发：scope参数错误或没有scope权限解决方法"><span class="nav-number">4.</span> <span class="nav-text">2017-09-16-微信开发：scope参数错误或没有scope权限解决方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-微信服务号绑定踩过的坑"><span class="nav-number">5.</span> <span class="nav-text">2017-09-16-微信服务号绑定踩过的坑</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-点击div标签下的href不跳转到目标页面，而是跳转到首页的问题"><span class="nav-number">6.</span> <span class="nav-text">2017-09-16-点击div标签下的href不跳转到目标页面，而是跳转到首页的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-简单的整数或者小数判断正则表达式"><span class="nav-number">7.</span> <span class="nav-text">2017-09-16-简单的整数或者小数判断正则表达式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-获取页面div下级的innerHtml"><span class="nav-number">8.</span> <span class="nav-text">2017-09-16-获取页面div下级的innerHtml</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-获取高德地图定位的js源码"><span class="nav-number">9.</span> <span class="nav-text">2017-09-16-获取高德地图定位的js源码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-解析微信xml消息使用的jar包"><span class="nav-number">10.</span> <span class="nav-text">2017-09-16-解析微信xml消息使用的jar包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-css图片资源加载失败？"><span class="nav-number">11.</span> <span class="nav-text">2017-09-16-css图片资源加载失败？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Eclipse-Java-EE找不到JSTL"><span class="nav-number">12.</span> <span class="nav-text">2017-09-16-Eclipse-Java-EE找不到JSTL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Eclipse-Java-EE-IDE修改web项目部署路径"><span class="nav-number">13.</span> <span class="nav-text">2017-09-16-Eclipse-Java-EE-IDE修改web项目部署路径</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-EL表达式，结果取整"><span class="nav-number">14.</span> <span class="nav-text">2017-09-16-EL表达式，结果取整</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Form表单提交后不跳转到新页面"><span class="nav-number">15.</span> <span class="nav-text">2017-09-16-Form表单提交后不跳转到新页面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-hibernate-hql实战小结"><span class="nav-number">16.</span> <span class="nav-text">2017-09-16-hibernate-hql实战小结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#表关联查询汇总排名"><span class="nav-number">16.1.</span> <span class="nav-text">表关联查询汇总排名</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-java去除HTML标签"><span class="nav-number">17.</span> <span class="nav-text">2017-09-16-java去除HTML标签</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-java字符串保存到Mysql中文乱码问题"><span class="nav-number">18.</span> <span class="nav-text">2017-09-16-java字符串保存到Mysql中文乱码问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-java获取当天24点"><span class="nav-number">19.</span> <span class="nav-text">2017-09-16-java获取当天24点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Java-获取指定日期之前或者之后的多少分钟"><span class="nav-number">20.</span> <span class="nav-text">2017-09-16 Java 获取指定日期之前或者之后的多少分钟</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-java-获取编码转换为utf-8"><span class="nav-number">21.</span> <span class="nav-text">2017-09-16-java-获取编码转换为utf-8</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-微信消息解析用到的Java-enum-枚举"><span class="nav-number">22.</span> <span class="nav-text">2017-09-16 微信消息解析用到的Java  enum 枚举</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Java-Integer自增"><span class="nav-number">23.</span> <span class="nav-text">2017-09-16-Java-Integer自增</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-JFinal传递map到JSP页面中"><span class="nav-number">24.</span> <span class="nav-text">2017-09-16-JFinal传递map到JSP页面中</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-JFinal使用WebSocket"><span class="nav-number">25.</span> <span class="nav-text">2017-09-16-JFinal使用WebSocket</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-JFinal-Controller中forwardAction的使用"><span class="nav-number">26.</span> <span class="nav-text">2017-09-16-JFinal-Controller中forwardAction的使用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-js中的“中文汉字”传到到java端乱码问题解决"><span class="nav-number">27.</span> <span class="nav-text">2017-09-16-js中的“中文汉字”传到到java端乱码问题解决</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Mac批量重命名文件"><span class="nav-number">28.</span> <span class="nav-text">2017-09-16-Mac批量重命名文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-MAC通过Microsoft-Remote-Desktop控制windows按键找回"><span class="nav-number">29.</span> <span class="nav-text">2017-09-16-MAC通过Microsoft-Remote-Desktop控制windows按键找回</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Mac-下安装Java-EE"><span class="nav-number">30.</span> <span class="nav-text">2017-09-16-Mac-下安装Java-EE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Mac-安装多个jdk踩过的坑"><span class="nav-number">31.</span> <span class="nav-text">2017-09-16-Mac-安装多个jdk踩过的坑</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-mac-chrome-开发者工具-快捷键"><span class="nav-number">32.</span> <span class="nav-text">2017-09-16-mac-chrome-开发者工具-快捷键</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Myeclipse普通java项目转maven项目"><span class="nav-number">33.</span> <span class="nav-text">2017-09-16-Myeclipse普通java项目转maven项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Mysql获取表中某个Datetime字段那天24点之前的数据"><span class="nav-number">34.</span> <span class="nav-text">2017-09-16-Mysql获取表中某个Datetime字段那天24点之前的数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Mysql-更新枚举enum类型"><span class="nav-number">35.</span> <span class="nav-text">2017-09-16-Mysql-更新枚举enum类型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Mysql-获取某个时间之后一段时间的方法"><span class="nav-number">36.</span> <span class="nav-text">2017-09-16-Mysql-获取某个时间之后一段时间的方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-web开发入门之中文乱码"><span class="nav-number">37.</span> <span class="nav-text">2017-09-16-web开发入门之中文乱码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-Windows查看端口占用"><span class="nav-number">38.</span> <span class="nav-text">2017-09-16-Windows查看端口占用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-9-13-Ubuntu环境初始化安装Mysql并配置外网访问"><span class="nav-number">39.</span> <span class="nav-text">2017-9-13-Ubuntu环境初始化安装Mysql并配置外网访问</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-9-19-Mysql-group-by报错"><span class="nav-number">40.</span> <span class="nav-text">2017-9-19-Mysql group by报错</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-微信公众号消息自动回复中文乱码问题"><span class="nav-number">41.</span> <span class="nav-text">2017-09-16-微信公众号消息自动回复中文乱码问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-小结：使用正则表达式提取时间中的数字"><span class="nav-number">42.</span> <span class="nav-text">2017-09-16-小结：使用正则表达式提取时间中的数字</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-定时获取微信的AccessToken"><span class="nav-number">43.</span> <span class="nav-text">2017-09-16-定时获取微信的AccessToken</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-使用JFinal添加数据报id异常"><span class="nav-number">44.</span> <span class="nav-text">2017-09-16-使用JFinal添加数据报id异常</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-使用jstl优化评论星标html代码"><span class="nav-number">45.</span> <span class="nav-text">2017-09-16-使用jstl优化评论星标html代码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-关于Tomcat自动加载更新class的小技巧"><span class="nav-number">46.</span> <span class="nav-text">2017-09-16-关于Tomcat自动加载更新class的小技巧</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2017-09-16-内网穿透"><span class="nav-number">47.</span> <span class="nav-text">2017-09-16-内网穿透</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">无</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
